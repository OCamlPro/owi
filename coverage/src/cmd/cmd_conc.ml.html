<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="utf-8"/>
    <title>cmd_conc.ml &mdash; Coverage report</title>
    <meta name="description" content="57.43% coverage in src/cmd/cmd_conc.ml">
    <link rel="stylesheet" href="../../coverage.css"/>
    <script src="../../highlight.pack.js"></script>
    <script>hljs.initHighlightingOnLoad();</script>
  </head>
  <body>
    <div id="header">
      <h1>
        <a href="../../index.html">
          <span class="dirname">src/cmd/</span>cmd_conc.ml
        </a>
      </h1>
      <h2>57.43%</h2>
    </div>
    <div id="navbar">
      <span class="some-visited" style="top:3.46%"></span>
      <span class="unvisited" style="top:4.76%"></span>
      <span class="unvisited" style="top:30.09%"></span>
      <span class="unvisited" style="top:30.30%"></span>
      <span class="unvisited" style="top:30.74%"></span>
      <span class="unvisited" style="top:30.95%"></span>
      <span class="unvisited" style="top:31.17%"></span>
      <span class="unvisited" style="top:31.60%"></span>
      <span class="unvisited" style="top:32.03%"></span>
      <span class="unvisited" style="top:32.25%"></span>
      <span class="unvisited" style="top:32.47%"></span>
      <span class="unvisited" style="top:34.20%"></span>
      <span class="unvisited" style="top:34.63%"></span>
      <span class="unvisited" style="top:35.06%"></span>
      <span class="unvisited" style="top:39.61%"></span>
      <span class="unvisited" style="top:39.83%"></span>
      <span class="unvisited" style="top:40.04%"></span>
      <span class="unvisited" style="top:40.26%"></span>
      <span class="unvisited" style="top:44.16%"></span>
      <span class="unvisited" style="top:48.48%"></span>
      <span class="unvisited" style="top:48.70%"></span>
      <span class="unvisited" style="top:48.92%"></span>
      <span class="unvisited" style="top:49.35%"></span>
      <span class="unvisited" style="top:49.78%"></span>
      <span class="unvisited" style="top:50.00%"></span>
      <span class="unvisited" style="bottom:49.78%"></span>
      <span class="unvisited" style="bottom:49.57%"></span>
      <span class="unvisited" style="bottom:48.27%"></span>
      <span class="unvisited" style="bottom:48.05%"></span>
      <span class="unvisited" style="bottom:47.84%"></span>
      <span class="unvisited" style="bottom:46.97%"></span>
      <span class="unvisited" style="bottom:46.75%"></span>
      <span class="unvisited" style="bottom:46.54%"></span>
      <span class="unvisited" style="bottom:46.10%"></span>
      <span class="unvisited" style="bottom:45.89%"></span>
      <span class="some-visited" style="bottom:41.13%"></span>
      <span class="unvisited" style="bottom:39.39%"></span>
      <span class="unvisited" style="bottom:38.74%"></span>
      <span class="unvisited" style="bottom:37.66%"></span>
      <span class="unvisited" style="bottom:37.23%"></span>
      <span class="unvisited" style="bottom:35.06%"></span>
      <span class="unvisited" style="bottom:33.98%"></span>
      <span class="some-visited" style="bottom:33.77%"></span>
      <span class="unvisited" style="bottom:32.90%"></span>
      <span class="unvisited" style="bottom:32.03%"></span>
      <span class="unvisited" style="bottom:31.39%"></span>
      <span class="unvisited" style="bottom:31.17%"></span>
      <span class="unvisited" style="bottom:30.74%"></span>
      <span class="unvisited" style="bottom:30.52%"></span>
      <span class="unvisited" style="bottom:30.30%"></span>
      <span class="unvisited" style="bottom:29.87%"></span>
      <span class="unvisited" style="bottom:29.65%"></span>
      <span class="unvisited" style="bottom:29.44%"></span>
      <span class="unvisited" style="bottom:29.00%"></span>
      <span class="unvisited" style="bottom:28.57%"></span>
      <span class="unvisited" style="bottom:28.35%"></span>
      <span class="unvisited" style="bottom:27.71%"></span>
      <span class="unvisited" style="bottom:27.49%"></span>
      <span class="unvisited" style="bottom:27.27%"></span>
      <span class="unvisited" style="bottom:26.84%"></span>
      <span class="unvisited" style="bottom:25.76%"></span>
      <span class="unvisited" style="bottom:24.03%"></span>
      <span class="some-visited" style="bottom:22.94%"></span>
      <span class="unvisited" style="bottom:22.51%"></span>
      <span class="unvisited" style="bottom:21.65%"></span>
      <span class="unvisited" style="bottom:21.00%"></span>
      <span class="unvisited" style="bottom:17.75%"></span>
      <span class="unvisited" style="bottom:17.53%"></span>
      <span class="unvisited" style="bottom:17.32%"></span>
      <span class="unvisited" style="bottom:16.88%"></span>
      <span class="unvisited" style="bottom:16.45%"></span>
      <span class="unvisited" style="bottom:16.02%"></span>
      <span class="unvisited" style="bottom:15.80%"></span>
      <span class="unvisited" style="bottom:15.37%"></span>
      <span class="unvisited" style="bottom:15.15%"></span>
      <span class="some-visited" style="bottom:12.34%"></span>
      <span class="some-visited" style="bottom:12.12%"></span>
      <span class="unvisited" style="bottom:9.31%"></span>
      <span class="unvisited" style="bottom:9.09%"></span>
      <span class="unvisited" style="bottom:8.44%"></span>
      <span class="unvisited" style="bottom:8.23%"></span>
      <span class="unvisited" style="bottom:8.01%"></span>
      <span class="unvisited" style="bottom:7.58%"></span>
      <span class="some-visited" style="bottom:4.11%"></span>
      <span class="unvisited" style="bottom:3.68%"></span>
      <span class="some-visited" style="bottom:1.73%"></span>
      <span class="unvisited" style="bottom:1.30%"></span>
    </div>
    <div id="report">
      <div id="lines-layer">
        <pre>
<a id="L1"></a><span > </span>
<a id="L2"></a><span > </span>
<a id="L3"></a><span > </span>
<a id="L4"></a><span > </span>
<a id="L5"></a><span > </span>
<a id="L6"></a><span > </span>
<a id="L7"></a><span > </span>
<a id="L8"></a><span > </span>
<a id="L9"></a><span class="visited"> </span>
<a id="L10"></a><span > </span>
<a id="L11"></a><span > </span>
<a id="L12"></a><span > </span>
<a id="L13"></a><span > </span>
<a id="L14"></a><span > </span>
<a id="L15"></a><span class="visited"> </span>
<a id="L16"></a><span class="some-visited"> </span>
<a id="L17"></a><span > </span>
<a id="L18"></a><span > </span>
<a id="L19"></a><span class="visited"> </span>
<a id="L20"></a><span > </span>
<a id="L21"></a><span class="visited"> </span>
<a id="L22"></a><span class="unvisited"> </span>
<a id="L23"></a><span > </span>
<a id="L24"></a><span > </span>
<a id="L25"></a><span class="visited"> </span>
<a id="L26"></a><span class="visited"> </span>
<a id="L27"></a><span class="visited"> </span>
<a id="L28"></a><span > </span>
<a id="L29"></a><span class="visited"> </span>
<a id="L30"></a><span class="visited"> </span>
<a id="L31"></a><span > </span>
<a id="L32"></a><span > </span>
<a id="L33"></a><span class="visited"> </span>
<a id="L34"></a><span > </span>
<a id="L35"></a><span > </span>
<a id="L36"></a><span > </span>
<a id="L37"></a><span > </span>
<a id="L38"></a><span > </span>
<a id="L39"></a><span class="visited"> </span>
<a id="L40"></a><span > </span>
<a id="L41"></a><span > </span>
<a id="L42"></a><span > </span>
<a id="L43"></a><span > </span>
<a id="L44"></a><span class="visited"> </span>
<a id="L45"></a><span class="visited"> </span>
<a id="L46"></a><span > </span>
<a id="L47"></a><span class="visited"> </span>
<a id="L48"></a><span class="visited"> </span>
<a id="L49"></a><span class="visited"> </span>
<a id="L50"></a><span class="visited"> </span>
<a id="L51"></a><span > </span>
<a id="L52"></a><span class="visited"> </span>
<a id="L53"></a><span > </span>
<a id="L54"></a><span > </span>
<a id="L55"></a><span > </span>
<a id="L56"></a><span class="visited"> </span>
<a id="L57"></a><span > </span>
<a id="L58"></a><span > </span>
<a id="L59"></a><span class="visited"> </span>
<a id="L60"></a><span > </span>
<a id="L61"></a><span class="visited"> </span>
<a id="L62"></a><span class="visited"> </span>
<a id="L63"></a><span class="visited"> </span>
<a id="L64"></a><span > </span>
<a id="L65"></a><span > </span>
<a id="L66"></a><span class="visited"> </span>
<a id="L67"></a><span class="visited"> </span>
<a id="L68"></a><span > </span>
<a id="L69"></a><span > </span>
<a id="L70"></a><span > </span>
<a id="L71"></a><span > </span>
<a id="L72"></a><span > </span>
<a id="L73"></a><span > </span>
<a id="L74"></a><span > </span>
<a id="L75"></a><span > </span>
<a id="L76"></a><span > </span>
<a id="L77"></a><span > </span>
<a id="L78"></a><span > </span>
<a id="L79"></a><span > </span>
<a id="L80"></a><span > </span>
<a id="L81"></a><span > </span>
<a id="L82"></a><span > </span>
<a id="L83"></a><span > </span>
<a id="L84"></a><span > </span>
<a id="L85"></a><span > </span>
<a id="L86"></a><span > </span>
<a id="L87"></a><span > </span>
<a id="L88"></a><span > </span>
<a id="L89"></a><span > </span>
<a id="L90"></a><span > </span>
<a id="L91"></a><span > </span>
<a id="L92"></a><span > </span>
<a id="L93"></a><span > </span>
<a id="L94"></a><span > </span>
<a id="L95"></a><span > </span>
<a id="L96"></a><span > </span>
<a id="L97"></a><span > </span>
<a id="L98"></a><span class="visited"> </span>
<a id="L99"></a><span > </span>
<a id="L100"></a><span > </span>
<a id="L101"></a><span > </span>
<a id="L102"></a><span > </span>
<a id="L103"></a><span > </span>
<a id="L104"></a><span class="visited"> </span>
<a id="L105"></a><span > </span>
<a id="L106"></a><span > </span>
<a id="L107"></a><span > </span>
<a id="L108"></a><span > </span>
<a id="L109"></a><span > </span>
<a id="L110"></a><span > </span>
<a id="L111"></a><span > </span>
<a id="L112"></a><span > </span>
<a id="L113"></a><span > </span>
<a id="L114"></a><span > </span>
<a id="L115"></a><span > </span>
<a id="L116"></a><span > </span>
<a id="L117"></a><span > </span>
<a id="L118"></a><span > </span>
<a id="L119"></a><span > </span>
<a id="L120"></a><span > </span>
<a id="L121"></a><span > </span>
<a id="L122"></a><span > </span>
<a id="L123"></a><span > </span>
<a id="L124"></a><span > </span>
<a id="L125"></a><span > </span>
<a id="L126"></a><span > </span>
<a id="L127"></a><span > </span>
<a id="L128"></a><span > </span>
<a id="L129"></a><span > </span>
<a id="L130"></a><span > </span>
<a id="L131"></a><span > </span>
<a id="L132"></a><span > </span>
<a id="L133"></a><span > </span>
<a id="L134"></a><span > </span>
<a id="L135"></a><span > </span>
<a id="L136"></a><span > </span>
<a id="L137"></a><span > </span>
<a id="L138"></a><span > </span>
<a id="L139"></a><span class="unvisited"> </span>
<a id="L140"></a><span class="unvisited"> </span>
<a id="L141"></a><span > </span>
<a id="L142"></a><span class="unvisited"> </span>
<a id="L143"></a><span class="unvisited"> </span>
<a id="L144"></a><span class="unvisited"> </span>
<a id="L145"></a><span > </span>
<a id="L146"></a><span class="unvisited"> </span>
<a id="L147"></a><span > </span>
<a id="L148"></a><span class="unvisited"> </span>
<a id="L149"></a><span class="unvisited"> </span>
<a id="L150"></a><span class="unvisited"> </span>
<a id="L151"></a><span > </span>
<a id="L152"></a><span > </span>
<a id="L153"></a><span > </span>
<a id="L154"></a><span > </span>
<a id="L155"></a><span class="visited"> </span>
<a id="L156"></a><span class="visited"> </span>
<a id="L157"></a><span > </span>
<a id="L158"></a><span class="unvisited"> </span>
<a id="L159"></a><span > </span>
<a id="L160"></a><span class="unvisited"> </span>
<a id="L161"></a><span > </span>
<a id="L162"></a><span class="unvisited"> </span>
<a id="L163"></a><span class="visited"> </span>
<a id="L164"></a><span class="visited"> </span>
<a id="L165"></a><span > </span>
<a id="L166"></a><span class="visited"> </span>
<a id="L167"></a><span > </span>
<a id="L168"></a><span > </span>
<a id="L169"></a><span class="visited"> </span>
<a id="L170"></a><span > </span>
<a id="L171"></a><span > </span>
<a id="L172"></a><span > </span>
<a id="L173"></a><span class="visited"> </span>
<a id="L174"></a><span > </span>
<a id="L175"></a><span > </span>
<a id="L176"></a><span class="visited"> </span>
<a id="L177"></a><span class="visited"> </span>
<a id="L178"></a><span > </span>
<a id="L179"></a><span > </span>
<a id="L180"></a><span class="visited"> </span>
<a id="L181"></a><span class="visited"> </span>
<a id="L182"></a><span > </span>
<a id="L183"></a><span class="unvisited"> </span>
<a id="L184"></a><span class="unvisited"> </span>
<a id="L185"></a><span class="unvisited"> </span>
<a id="L186"></a><span class="unvisited"> </span>
<a id="L187"></a><span > </span>
<a id="L188"></a><span > </span>
<a id="L189"></a><span class="visited"> </span>
<a id="L190"></a><span class="visited"> </span>
<a id="L191"></a><span class="visited"> </span>
<a id="L192"></a><span > </span>
<a id="L193"></a><span > </span>
<a id="L194"></a><span > </span>
<a id="L195"></a><span > </span>
<a id="L196"></a><span class="visited"> </span>
<a id="L197"></a><span class="visited"> </span>
<a id="L198"></a><span > </span>
<a id="L199"></a><span > </span>
<a id="L200"></a><span > </span>
<a id="L201"></a><span class="visited"> </span>
<a id="L202"></a><span > </span>
<a id="L203"></a><span class="visited"> </span>
<a id="L204"></a><span class="unvisited"> </span>
<a id="L205"></a><span > </span>
<a id="L206"></a><span > </span>
<a id="L207"></a><span class="visited"> </span>
<a id="L208"></a><span > </span>
<a id="L209"></a><span > </span>
<a id="L210"></a><span > </span>
<a id="L211"></a><span class="visited"> </span>
<a id="L212"></a><span > </span>
<a id="L213"></a><span class="visited"> </span>
<a id="L214"></a><span > </span>
<a id="L215"></a><span > </span>
<a id="L216"></a><span > </span>
<a id="L217"></a><span class="visited"> </span>
<a id="L218"></a><span class="visited"> </span>
<a id="L219"></a><span class="visited"> </span>
<a id="L220"></a><span > </span>
<a id="L221"></a><span > </span>
<a id="L222"></a><span > </span>
<a id="L223"></a><span > </span>
<a id="L224"></a><span class="unvisited"> </span>
<a id="L225"></a><span class="unvisited"> </span>
<a id="L226"></a><span class="unvisited"> </span>
<a id="L227"></a><span > </span>
<a id="L228"></a><span class="unvisited"> </span>
<a id="L229"></a><span > </span>
<a id="L230"></a><span class="unvisited"> </span>
<a id="L231"></a><span class="unvisited"> </span>
<a id="L232"></a><span class="unvisited"> </span>
<a id="L233"></a><span class="unvisited"> </span>
<a id="L234"></a><span > </span>
<a id="L235"></a><span > </span>
<a id="L236"></a><span > </span>
<a id="L237"></a><span > </span>
<a id="L238"></a><span > </span>
<a id="L239"></a><span class="unvisited"> </span>
<a id="L240"></a><span class="unvisited"> </span>
<a id="L241"></a><span class="unvisited"> </span>
<a id="L242"></a><span > </span>
<a id="L243"></a><span > </span>
<a id="L244"></a><span > </span>
<a id="L245"></a><span class="unvisited"> </span>
<a id="L246"></a><span class="unvisited"> </span>
<a id="L247"></a><span class="unvisited"> </span>
<a id="L248"></a><span > </span>
<a id="L249"></a><span class="unvisited"> </span>
<a id="L250"></a><span class="unvisited"> </span>
<a id="L251"></a><span > </span>
<a id="L252"></a><span > </span>
<a id="L253"></a><span > </span>
<a id="L254"></a><span > </span>
<a id="L255"></a><span > </span>
<a id="L256"></a><span > </span>
<a id="L257"></a><span class="visited"> </span>
<a id="L258"></a><span class="visited"> </span>
<a id="L259"></a><span > </span>
<a id="L260"></a><span > </span>
<a id="L261"></a><span class="visited"> </span>
<a id="L262"></a><span class="visited"> </span>
<a id="L263"></a><span class="visited"> </span>
<a id="L264"></a><span > </span>
<a id="L265"></a><span > </span>
<a id="L266"></a><span > </span>
<a id="L267"></a><span > </span>
<a id="L268"></a><span > </span>
<a id="L269"></a><span > </span>
<a id="L270"></a><span > </span>
<a id="L271"></a><span > </span>
<a id="L272"></a><span class="some-visited"> </span>
<a id="L273"></a><span > </span>
<a id="L274"></a><span class="visited"> </span>
<a id="L275"></a><span > </span>
<a id="L276"></a><span > </span>
<a id="L277"></a><span class="visited"> </span>
<a id="L278"></a><span > </span>
<a id="L279"></a><span class="visited"> </span>
<a id="L280"></a><span class="unvisited"> </span>
<a id="L281"></a><span class="visited"> </span>
<a id="L282"></a><span class="visited"> </span>
<a id="L283"></a><span class="unvisited"> </span>
<a id="L284"></a><span > </span>
<a id="L285"></a><span class="visited"> </span>
<a id="L286"></a><span class="visited"> </span>
<a id="L287"></a><span > </span>
<a id="L288"></a><span class="unvisited"> </span>
<a id="L289"></a><span > </span>
<a id="L290"></a><span class="unvisited"> </span>
<a id="L291"></a><span > </span>
<a id="L292"></a><span class="visited"> </span>
<a id="L293"></a><span class="visited"> </span>
<a id="L294"></a><span > </span>
<a id="L295"></a><span > </span>
<a id="L296"></a><span > </span>
<a id="L297"></a><span class="visited"> </span>
<a id="L298"></a><span class="visited"> </span>
<a id="L299"></a><span > </span>
<a id="L300"></a><span class="unvisited"> </span>
<a id="L301"></a><span > </span>
<a id="L302"></a><span class="visited"> </span>
<a id="L303"></a><span class="visited"> </span>
<a id="L304"></a><span > </span>
<a id="L305"></a><span class="unvisited"> </span>
<a id="L306"></a><span class="some-visited"> </span>
<a id="L307"></a><span class="visited"> </span>
<a id="L308"></a><span > </span>
<a id="L309"></a><span > </span>
<a id="L310"></a><span class="unvisited"> </span>
<a id="L311"></a><span > </span>
<a id="L312"></a><span class="visited"> </span>
<a id="L313"></a><span > </span>
<a id="L314"></a><span class="unvisited"> </span>
<a id="L315"></a><span > </span>
<a id="L316"></a><span > </span>
<a id="L317"></a><span class="unvisited"> </span>
<a id="L318"></a><span class="unvisited"> </span>
<a id="L319"></a><span > </span>
<a id="L320"></a><span class="unvisited"> </span>
<a id="L321"></a><span class="unvisited"> </span>
<a id="L322"></a><span class="unvisited"> </span>
<a id="L323"></a><span > </span>
<a id="L324"></a><span class="unvisited"> </span>
<a id="L325"></a><span class="unvisited"> </span>
<a id="L326"></a><span class="unvisited"> </span>
<a id="L327"></a><span > </span>
<a id="L328"></a><span class="unvisited"> </span>
<a id="L329"></a><span > </span>
<a id="L330"></a><span class="unvisited"> </span>
<a id="L331"></a><span class="unvisited"> </span>
<a id="L332"></a><span > </span>
<a id="L333"></a><span > </span>
<a id="L334"></a><span class="unvisited"> </span>
<a id="L335"></a><span class="unvisited"> </span>
<a id="L336"></a><span class="unvisited"> </span>
<a id="L337"></a><span > </span>
<a id="L338"></a><span class="unvisited"> </span>
<a id="L339"></a><span > </span>
<a id="L340"></a><span > </span>
<a id="L341"></a><span class="visited"> </span>
<a id="L342"></a><span class="visited"> </span>
<a id="L343"></a><span class="unvisited"> </span>
<a id="L344"></a><span class="visited"> </span>
<a id="L345"></a><span > </span>
<a id="L346"></a><span > </span>
<a id="L347"></a><span class="visited"> </span>
<a id="L348"></a><span > </span>
<a id="L349"></a><span > </span>
<a id="L350"></a><span class="visited"> </span>
<a id="L351"></a><span class="unvisited"> </span>
<a id="L352"></a><span class="visited"> </span>
<a id="L353"></a><span > </span>
<a id="L354"></a><span > </span>
<a id="L355"></a><span class="visited"> </span>
<a id="L356"></a><span class="some-visited"> </span>
<a id="L357"></a><span > </span>
<a id="L358"></a><span class="unvisited"> </span>
<a id="L359"></a><span > </span>
<a id="L360"></a><span > </span>
<a id="L361"></a><span class="visited"> </span>
<a id="L362"></a><span class="unvisited"> </span>
<a id="L363"></a><span class="visited"> </span>
<a id="L364"></a><span > </span>
<a id="L365"></a><span class="unvisited"> </span>
<a id="L366"></a><span > </span>
<a id="L367"></a><span > </span>
<a id="L368"></a><span > </span>
<a id="L369"></a><span class="visited"> </span>
<a id="L370"></a><span > </span>
<a id="L371"></a><span > </span>
<a id="L372"></a><span class="visited"> </span>
<a id="L373"></a><span > </span>
<a id="L374"></a><span class="visited"> </span>
<a id="L375"></a><span class="visited"> </span>
<a id="L376"></a><span > </span>
<a id="L377"></a><span class="visited"> </span>
<a id="L378"></a><span class="visited"> </span>
<a id="L379"></a><span class="visited"> </span>
<a id="L380"></a><span class="unvisited"> </span>
<a id="L381"></a><span class="unvisited"> </span>
<a id="L382"></a><span class="unvisited"> </span>
<a id="L383"></a><span > </span>
<a id="L384"></a><span class="unvisited"> </span>
<a id="L385"></a><span > </span>
<a id="L386"></a><span class="unvisited"> </span>
<a id="L387"></a><span > </span>
<a id="L388"></a><span class="unvisited"> </span>
<a id="L389"></a><span class="unvisited"> </span>
<a id="L390"></a><span > </span>
<a id="L391"></a><span class="unvisited"> </span>
<a id="L392"></a><span class="unvisited"> </span>
<a id="L393"></a><span > </span>
<a id="L394"></a><span class="visited"> </span>
<a id="L395"></a><span class="visited"> </span>
<a id="L396"></a><span > </span>
<a id="L397"></a><span > </span>
<a id="L398"></a><span > </span>
<a id="L399"></a><span > </span>
<a id="L400"></a><span > </span>
<a id="L401"></a><span > </span>
<a id="L402"></a><span > </span>
<a id="L403"></a><span > </span>
<a id="L404"></a><span > </span>
<a id="L405"></a><span class="some-visited"> </span>
<a id="L406"></a><span class="some-visited"> </span>
<a id="L407"></a><span > </span>
<a id="L408"></a><span > </span>
<a id="L409"></a><span > </span>
<a id="L410"></a><span class="visited"> </span>
<a id="L411"></a><span class="visited"> </span>
<a id="L412"></a><span class="visited"> </span>
<a id="L413"></a><span class="visited"> </span>
<a id="L414"></a><span > </span>
<a id="L415"></a><span class="visited"> </span>
<a id="L416"></a><span class="visited"> </span>
<a id="L417"></a><span > </span>
<a id="L418"></a><span class="visited"> </span>
<a id="L419"></a><span class="unvisited"> </span>
<a id="L420"></a><span class="unvisited"> </span>
<a id="L421"></a><span > </span>
<a id="L422"></a><span > </span>
<a id="L423"></a><span class="unvisited"> </span>
<a id="L424"></a><span class="unvisited"> </span>
<a id="L425"></a><span class="unvisited"> </span>
<a id="L426"></a><span > </span>
<a id="L427"></a><span class="unvisited"> </span>
<a id="L428"></a><span > </span>
<a id="L429"></a><span > </span>
<a id="L430"></a><span > </span>
<a id="L431"></a><span class="visited"> </span>
<a id="L432"></a><span class="visited"> </span>
<a id="L433"></a><span class="visited"> </span>
<a id="L434"></a><span class="visited"> </span>
<a id="L435"></a><span > </span>
<a id="L436"></a><span > </span>
<a id="L437"></a><span > </span>
<a id="L438"></a><span class="visited"> </span>
<a id="L439"></a><span > </span>
<a id="L440"></a><span class="visited"> </span>
<a id="L441"></a><span class="visited"> </span>
<a id="L442"></a><span class="visited"> </span>
<a id="L443"></a><span class="some-visited"> </span>
<a id="L444"></a><span > </span>
<a id="L445"></a><span class="unvisited"> </span>
<a id="L446"></a><span > </span>
<a id="L447"></a><span class="visited"> </span>
<a id="L448"></a><span > </span>
<a id="L449"></a><span class="visited"> </span>
<a id="L450"></a><span class="visited"> </span>
<a id="L451"></a><span class="visited"> </span>
<a id="L452"></a><span class="visited"> </span>
<a id="L453"></a><span > </span>
<a id="L454"></a><span class="some-visited"> </span>
<a id="L455"></a><span > </span>
<a id="L456"></a><span class="unvisited"> </span>
<a id="L457"></a><span > </span>
<a id="L458"></a><span class="visited"> </span>
<a id="L459"></a><span > </span>
<a id="L460"></a><span class="visited"> </span>
<a id="L461"></a><span class="visited"> </span>
<a id="L462"></a><span class="visited"> </span>
</pre>
      </div>
      <div id="text-layer">
        <pre id="line-numbers">
<a href="#L1">  1</a>
<a href="#L2">  2</a>
<a href="#L3">  3</a>
<a href="#L4">  4</a>
<a href="#L5">  5</a>
<a href="#L6">  6</a>
<a href="#L7">  7</a>
<a href="#L8">  8</a>
<a href="#L9">  9</a>
<a href="#L10"> 10</a>
<a href="#L11"> 11</a>
<a href="#L12"> 12</a>
<a href="#L13"> 13</a>
<a href="#L14"> 14</a>
<a href="#L15"> 15</a>
<a href="#L16"> 16</a>
<a href="#L17"> 17</a>
<a href="#L18"> 18</a>
<a href="#L19"> 19</a>
<a href="#L20"> 20</a>
<a href="#L21"> 21</a>
<a href="#L22"> 22</a>
<a href="#L23"> 23</a>
<a href="#L24"> 24</a>
<a href="#L25"> 25</a>
<a href="#L26"> 26</a>
<a href="#L27"> 27</a>
<a href="#L28"> 28</a>
<a href="#L29"> 29</a>
<a href="#L30"> 30</a>
<a href="#L31"> 31</a>
<a href="#L32"> 32</a>
<a href="#L33"> 33</a>
<a href="#L34"> 34</a>
<a href="#L35"> 35</a>
<a href="#L36"> 36</a>
<a href="#L37"> 37</a>
<a href="#L38"> 38</a>
<a href="#L39"> 39</a>
<a href="#L40"> 40</a>
<a href="#L41"> 41</a>
<a href="#L42"> 42</a>
<a href="#L43"> 43</a>
<a href="#L44"> 44</a>
<a href="#L45"> 45</a>
<a href="#L46"> 46</a>
<a href="#L47"> 47</a>
<a href="#L48"> 48</a>
<a href="#L49"> 49</a>
<a href="#L50"> 50</a>
<a href="#L51"> 51</a>
<a href="#L52"> 52</a>
<a href="#L53"> 53</a>
<a href="#L54"> 54</a>
<a href="#L55"> 55</a>
<a href="#L56"> 56</a>
<a href="#L57"> 57</a>
<a href="#L58"> 58</a>
<a href="#L59"> 59</a>
<a href="#L60"> 60</a>
<a href="#L61"> 61</a>
<a href="#L62"> 62</a>
<a href="#L63"> 63</a>
<a href="#L64"> 64</a>
<a href="#L65"> 65</a>
<a href="#L66"> 66</a>
<a href="#L67"> 67</a>
<a href="#L68"> 68</a>
<a href="#L69"> 69</a>
<a href="#L70"> 70</a>
<a href="#L71"> 71</a>
<a href="#L72"> 72</a>
<a href="#L73"> 73</a>
<a href="#L74"> 74</a>
<a href="#L75"> 75</a>
<a href="#L76"> 76</a>
<a href="#L77"> 77</a>
<a href="#L78"> 78</a>
<a href="#L79"> 79</a>
<a href="#L80"> 80</a>
<a href="#L81"> 81</a>
<a href="#L82"> 82</a>
<a href="#L83"> 83</a>
<a href="#L84"> 84</a>
<a href="#L85"> 85</a>
<a href="#L86"> 86</a>
<a href="#L87"> 87</a>
<a href="#L88"> 88</a>
<a href="#L89"> 89</a>
<a href="#L90"> 90</a>
<a href="#L91"> 91</a>
<a href="#L92"> 92</a>
<a href="#L93"> 93</a>
<a href="#L94"> 94</a>
<a href="#L95"> 95</a>
<a href="#L96"> 96</a>
<a href="#L97"> 97</a>
<a href="#L98"> 98</a>
<a href="#L99"> 99</a>
<a href="#L100">100</a>
<a href="#L101">101</a>
<a href="#L102">102</a>
<a href="#L103">103</a>
<a href="#L104">104</a>
<a href="#L105">105</a>
<a href="#L106">106</a>
<a href="#L107">107</a>
<a href="#L108">108</a>
<a href="#L109">109</a>
<a href="#L110">110</a>
<a href="#L111">111</a>
<a href="#L112">112</a>
<a href="#L113">113</a>
<a href="#L114">114</a>
<a href="#L115">115</a>
<a href="#L116">116</a>
<a href="#L117">117</a>
<a href="#L118">118</a>
<a href="#L119">119</a>
<a href="#L120">120</a>
<a href="#L121">121</a>
<a href="#L122">122</a>
<a href="#L123">123</a>
<a href="#L124">124</a>
<a href="#L125">125</a>
<a href="#L126">126</a>
<a href="#L127">127</a>
<a href="#L128">128</a>
<a href="#L129">129</a>
<a href="#L130">130</a>
<a href="#L131">131</a>
<a href="#L132">132</a>
<a href="#L133">133</a>
<a href="#L134">134</a>
<a href="#L135">135</a>
<a href="#L136">136</a>
<a href="#L137">137</a>
<a href="#L138">138</a>
<a href="#L139">139</a>
<a href="#L140">140</a>
<a href="#L141">141</a>
<a href="#L142">142</a>
<a href="#L143">143</a>
<a href="#L144">144</a>
<a href="#L145">145</a>
<a href="#L146">146</a>
<a href="#L147">147</a>
<a href="#L148">148</a>
<a href="#L149">149</a>
<a href="#L150">150</a>
<a href="#L151">151</a>
<a href="#L152">152</a>
<a href="#L153">153</a>
<a href="#L154">154</a>
<a href="#L155">155</a>
<a href="#L156">156</a>
<a href="#L157">157</a>
<a href="#L158">158</a>
<a href="#L159">159</a>
<a href="#L160">160</a>
<a href="#L161">161</a>
<a href="#L162">162</a>
<a href="#L163">163</a>
<a href="#L164">164</a>
<a href="#L165">165</a>
<a href="#L166">166</a>
<a href="#L167">167</a>
<a href="#L168">168</a>
<a href="#L169">169</a>
<a href="#L170">170</a>
<a href="#L171">171</a>
<a href="#L172">172</a>
<a href="#L173">173</a>
<a href="#L174">174</a>
<a href="#L175">175</a>
<a href="#L176">176</a>
<a href="#L177">177</a>
<a href="#L178">178</a>
<a href="#L179">179</a>
<a href="#L180">180</a>
<a href="#L181">181</a>
<a href="#L182">182</a>
<a href="#L183">183</a>
<a href="#L184">184</a>
<a href="#L185">185</a>
<a href="#L186">186</a>
<a href="#L187">187</a>
<a href="#L188">188</a>
<a href="#L189">189</a>
<a href="#L190">190</a>
<a href="#L191">191</a>
<a href="#L192">192</a>
<a href="#L193">193</a>
<a href="#L194">194</a>
<a href="#L195">195</a>
<a href="#L196">196</a>
<a href="#L197">197</a>
<a href="#L198">198</a>
<a href="#L199">199</a>
<a href="#L200">200</a>
<a href="#L201">201</a>
<a href="#L202">202</a>
<a href="#L203">203</a>
<a href="#L204">204</a>
<a href="#L205">205</a>
<a href="#L206">206</a>
<a href="#L207">207</a>
<a href="#L208">208</a>
<a href="#L209">209</a>
<a href="#L210">210</a>
<a href="#L211">211</a>
<a href="#L212">212</a>
<a href="#L213">213</a>
<a href="#L214">214</a>
<a href="#L215">215</a>
<a href="#L216">216</a>
<a href="#L217">217</a>
<a href="#L218">218</a>
<a href="#L219">219</a>
<a href="#L220">220</a>
<a href="#L221">221</a>
<a href="#L222">222</a>
<a href="#L223">223</a>
<a href="#L224">224</a>
<a href="#L225">225</a>
<a href="#L226">226</a>
<a href="#L227">227</a>
<a href="#L228">228</a>
<a href="#L229">229</a>
<a href="#L230">230</a>
<a href="#L231">231</a>
<a href="#L232">232</a>
<a href="#L233">233</a>
<a href="#L234">234</a>
<a href="#L235">235</a>
<a href="#L236">236</a>
<a href="#L237">237</a>
<a href="#L238">238</a>
<a href="#L239">239</a>
<a href="#L240">240</a>
<a href="#L241">241</a>
<a href="#L242">242</a>
<a href="#L243">243</a>
<a href="#L244">244</a>
<a href="#L245">245</a>
<a href="#L246">246</a>
<a href="#L247">247</a>
<a href="#L248">248</a>
<a href="#L249">249</a>
<a href="#L250">250</a>
<a href="#L251">251</a>
<a href="#L252">252</a>
<a href="#L253">253</a>
<a href="#L254">254</a>
<a href="#L255">255</a>
<a href="#L256">256</a>
<a href="#L257">257</a>
<a href="#L258">258</a>
<a href="#L259">259</a>
<a href="#L260">260</a>
<a href="#L261">261</a>
<a href="#L262">262</a>
<a href="#L263">263</a>
<a href="#L264">264</a>
<a href="#L265">265</a>
<a href="#L266">266</a>
<a href="#L267">267</a>
<a href="#L268">268</a>
<a href="#L269">269</a>
<a href="#L270">270</a>
<a href="#L271">271</a>
<a href="#L272">272</a>
<a href="#L273">273</a>
<a href="#L274">274</a>
<a href="#L275">275</a>
<a href="#L276">276</a>
<a href="#L277">277</a>
<a href="#L278">278</a>
<a href="#L279">279</a>
<a href="#L280">280</a>
<a href="#L281">281</a>
<a href="#L282">282</a>
<a href="#L283">283</a>
<a href="#L284">284</a>
<a href="#L285">285</a>
<a href="#L286">286</a>
<a href="#L287">287</a>
<a href="#L288">288</a>
<a href="#L289">289</a>
<a href="#L290">290</a>
<a href="#L291">291</a>
<a href="#L292">292</a>
<a href="#L293">293</a>
<a href="#L294">294</a>
<a href="#L295">295</a>
<a href="#L296">296</a>
<a href="#L297">297</a>
<a href="#L298">298</a>
<a href="#L299">299</a>
<a href="#L300">300</a>
<a href="#L301">301</a>
<a href="#L302">302</a>
<a href="#L303">303</a>
<a href="#L304">304</a>
<a href="#L305">305</a>
<a href="#L306">306</a>
<a href="#L307">307</a>
<a href="#L308">308</a>
<a href="#L309">309</a>
<a href="#L310">310</a>
<a href="#L311">311</a>
<a href="#L312">312</a>
<a href="#L313">313</a>
<a href="#L314">314</a>
<a href="#L315">315</a>
<a href="#L316">316</a>
<a href="#L317">317</a>
<a href="#L318">318</a>
<a href="#L319">319</a>
<a href="#L320">320</a>
<a href="#L321">321</a>
<a href="#L322">322</a>
<a href="#L323">323</a>
<a href="#L324">324</a>
<a href="#L325">325</a>
<a href="#L326">326</a>
<a href="#L327">327</a>
<a href="#L328">328</a>
<a href="#L329">329</a>
<a href="#L330">330</a>
<a href="#L331">331</a>
<a href="#L332">332</a>
<a href="#L333">333</a>
<a href="#L334">334</a>
<a href="#L335">335</a>
<a href="#L336">336</a>
<a href="#L337">337</a>
<a href="#L338">338</a>
<a href="#L339">339</a>
<a href="#L340">340</a>
<a href="#L341">341</a>
<a href="#L342">342</a>
<a href="#L343">343</a>
<a href="#L344">344</a>
<a href="#L345">345</a>
<a href="#L346">346</a>
<a href="#L347">347</a>
<a href="#L348">348</a>
<a href="#L349">349</a>
<a href="#L350">350</a>
<a href="#L351">351</a>
<a href="#L352">352</a>
<a href="#L353">353</a>
<a href="#L354">354</a>
<a href="#L355">355</a>
<a href="#L356">356</a>
<a href="#L357">357</a>
<a href="#L358">358</a>
<a href="#L359">359</a>
<a href="#L360">360</a>
<a href="#L361">361</a>
<a href="#L362">362</a>
<a href="#L363">363</a>
<a href="#L364">364</a>
<a href="#L365">365</a>
<a href="#L366">366</a>
<a href="#L367">367</a>
<a href="#L368">368</a>
<a href="#L369">369</a>
<a href="#L370">370</a>
<a href="#L371">371</a>
<a href="#L372">372</a>
<a href="#L373">373</a>
<a href="#L374">374</a>
<a href="#L375">375</a>
<a href="#L376">376</a>
<a href="#L377">377</a>
<a href="#L378">378</a>
<a href="#L379">379</a>
<a href="#L380">380</a>
<a href="#L381">381</a>
<a href="#L382">382</a>
<a href="#L383">383</a>
<a href="#L384">384</a>
<a href="#L385">385</a>
<a href="#L386">386</a>
<a href="#L387">387</a>
<a href="#L388">388</a>
<a href="#L389">389</a>
<a href="#L390">390</a>
<a href="#L391">391</a>
<a href="#L392">392</a>
<a href="#L393">393</a>
<a href="#L394">394</a>
<a href="#L395">395</a>
<a href="#L396">396</a>
<a href="#L397">397</a>
<a href="#L398">398</a>
<a href="#L399">399</a>
<a href="#L400">400</a>
<a href="#L401">401</a>
<a href="#L402">402</a>
<a href="#L403">403</a>
<a href="#L404">404</a>
<a href="#L405">405</a>
<a href="#L406">406</a>
<a href="#L407">407</a>
<a href="#L408">408</a>
<a href="#L409">409</a>
<a href="#L410">410</a>
<a href="#L411">411</a>
<a href="#L412">412</a>
<a href="#L413">413</a>
<a href="#L414">414</a>
<a href="#L415">415</a>
<a href="#L416">416</a>
<a href="#L417">417</a>
<a href="#L418">418</a>
<a href="#L419">419</a>
<a href="#L420">420</a>
<a href="#L421">421</a>
<a href="#L422">422</a>
<a href="#L423">423</a>
<a href="#L424">424</a>
<a href="#L425">425</a>
<a href="#L426">426</a>
<a href="#L427">427</a>
<a href="#L428">428</a>
<a href="#L429">429</a>
<a href="#L430">430</a>
<a href="#L431">431</a>
<a href="#L432">432</a>
<a href="#L433">433</a>
<a href="#L434">434</a>
<a href="#L435">435</a>
<a href="#L436">436</a>
<a href="#L437">437</a>
<a href="#L438">438</a>
<a href="#L439">439</a>
<a href="#L440">440</a>
<a href="#L441">441</a>
<a href="#L442">442</a>
<a href="#L443">443</a>
<a href="#L444">444</a>
<a href="#L445">445</a>
<a href="#L446">446</a>
<a href="#L447">447</a>
<a href="#L448">448</a>
<a href="#L449">449</a>
<a href="#L450">450</a>
<a href="#L451">451</a>
<a href="#L452">452</a>
<a href="#L453">453</a>
<a href="#L454">454</a>
<a href="#L455">455</a>
<a href="#L456">456</a>
<a href="#L457">457</a>
<a href="#L458">458</a>
<a href="#L459">459</a>
<a href="#L460">460</a>
<a href="#L461">461</a>
<a href="#L462">462</a>
</pre>
<pre><code class="ocaml">(* SPDX-License-Identifier: AGPL-3.0-or-later *)
(* Copyright Â© 2021-2024 OCamlPro *)
(* Written by the Owi programmers *)

open Syntax
module Choice = Concolic.P.Choice

(* let () = Random.self_init () *)
let () = Random.ini<span data-count="656">t</span> 42

let debug = false

let ( let** ) (t : 'a Result.t Choice.t) (f : 'a -&gt; 'b Result.t Choice.t) :
  'b Result.t Choice.t =
  <span data-count="14">C</span>hoice.bind t (fun t -&gt;
      <span data-count="14">m</span>atch t with <span data-count="0">E</span>rror e -&gt; Choice.return (Error e) | <span data-count="14">O</span>k x -&gt; f x )

let simplify_then_link ~unsafe ~optimize link_state m =
  <span data-count="4">l</span>et* m =
    match m with
    | <span data-count="2">K</span>ind.Wat _ | <span data-count="2">W</span>asm _ -&gt; Compile.Any.until_typechec<span data-count="4">k</span> ~unsafe m
    | <span data-count="0">W</span>ast _ -&gt; Error (`Msg "can't run concolic interpreter on a script")
    | Ocaml _ -&gt; assert false
  in
  <span data-count="4">l</span>et* m = Cmd_utils.add_main_as_star<span data-count="4">t</span> m in
  <span data-count="4">l</span>et+ m, link_state =
    Compile.Binary.until_lin<span data-count="4">k</span> ~unsafe link_state ~optimize ~name:None m
  in
  <span data-count="4">l</span>et module_to_run = Concolic.convert_module_to_run m in
  <span data-count="4">(</span>link_state, module_to_run)

let simplify_then_link_files ~unsafe ~optimize filenames =
  <span data-count="4">l</span>et link_state = Link.empty_state in
  let link_state =
    Link.extern_module' link_state ~name:"symbolic"
      ~func_typ:Concolic.P.Extern_func.extern_type
      Concolic_wasm_ffi.symbolic_extern_module
  in
  <span data-count="4">l</span>et link_state =
    Link.extern_module' link_state ~name:"summaries"
      ~func_typ:Concolic.P.Extern_func.extern_type
      Concolic_wasm_ffi.summaries_extern_module
  in
  <span data-count="4">l</span>et+ link_state, modules_to_run =
    List.fold_lef<span data-count="4">t</span>
      (fun (acc : (_ * _) Result.t) filename -&gt;
        <span data-count="4">l</span>et* link_state, modules_to_run = acc in
        <span data-count="4">l</span>et* m0dule = Parse.guess_from_fil<span data-count="4">e</span> filename in
        <span data-count="4">l</span>et+ link_state, module_to_run =
          simplify_then_lin<span data-count="4">k</span> ~unsafe ~optimize link_state m0dule
        in
        <span data-count="4">(</span>link_state, module_to_run :: modules_to_run) )
      (Ok (link_state, []))
      filenames
  in
  <span data-count="4">(</span>link_state, List.re<span data-count="4">v</span> modules_to_run)

let run_modules_to_run (link_state : _ Link.state) modules_to_run =
  <span data-count="14">L</span>ist.fold_left
    (fun (acc : unit Result.t Concolic.P.Choice.t) to_run -&gt;
      <span data-count="14">l</span>et** () = acc in
      <span data-count="14">(</span>Interpret.Concolic.modu<span data-count="14">l</span> link_state.envs) to_run )
    (Choice.retur<span data-count="14">n</span> (Ok ())) modules_to_run

let get_model ~symbols solver pc =
  <span data-count="3">l</span>et pc = Concolic_choice.pc_to_exprs pc in
  <span data-count="3">S</span>olver.model ~symbols ~pc solver

type assignments = (Smtml.Symbol.t * Concrete_value.t) list

type end_of_trace =
  | Assume_fail
  | Assert_fail
  | Trap of Trap.t
  | Normal

type trace =
  { assignments : assignments
  ; remaining_pc : Concolic_choice.pc_elt list
  ; end_of_trace : end_of_trace
  }

module IMap = Map.Make (Prelude.Int32)

module Unexplored : sig
  type t

  val none : t -&gt; bool

  val zero : t

  val one : t

  val add : t -&gt; t -&gt; t
end = struct
  type t = int

  let none t = <span data-count="20">t</span> = 0

  let zero = 0

  let one = 1

  let add a b = <span data-count="24">a</span> + b
end

type unexplored = Unexplored.t

type node =
  | Select of
      { cond : Smtml.Expr.t
      ; if_true : eval_tree
      ; if_false : eval_tree
      }
  | Select_i32 of
      { value : Smtml.Expr.t
      ; branches : eval_tree IMap.t
      }
  | Assume of
      { cond : Smtml.Expr.t
      ; cont : eval_tree
      }
  | Assert of
      { cond : Smtml.Expr.t
      ; cont : eval_tree
      ; mutable disproved : assignments option
      }
  | Unreachable
  | Not_explored

and eval_tree =
  { mutable node : node
  ; mutable unexplored : unexplored
  ; pc : Concolic_choice.pc
  ; mutable ends : (end_of_trace * assignments) list
  }

let rec rec_count_unexplored tree =
  <span data-count="0">m</span>atch tree.node with
  | <span data-count="0">S</span>elect { if_true; if_false; _ } -&gt;
    Unexplored.add
      (rec_count_unexplore<span data-count="0">d</span> if_true)
      (rec_count_unexplore<span data-count="0">d</span> if_false)
  | <span data-count="0">S</span>elect_i32 { branches; _ } -&gt;
    IMap.fold
      (fun _ branch -&gt; <span data-count="0">U</span>nexplored.add (rec_count_unexplore<span data-count="0">d</span> branch))
      branches Unexplored.zero
  | <span data-count="0">A</span>ssume { cont; _ } | <span data-count="0">A</span>ssert { cont; _ } -&gt; rec_count_unexplored cont
  | <span data-count="0">U</span>nreachable -&gt; Unexplored.zero
  | <span data-count="0">N</span>ot_explored -&gt; Unexplored.one

let _ = rec_count_unexplored

let count_unexplored tree =
  <span data-count="38">m</span>atch tree.node with
  | <span data-count="24">S</span>elect { if_true; if_false; _ } -&gt;
    Unexplored.add if_true.unexplored if_false.unexplored
  | <span data-count="0">S</span>elect_i32 { branches; _ } -&gt;
    IMap.fold
      (fun _ branch -&gt; <span data-count="0">U</span>nexplored.add branch.unexplored)
      branches Unexplored.zero
  | <span data-count="0">A</span>ssume { cont; _ } | <span data-count="0">A</span>ssert { cont; _ } -&gt; cont.unexplored
  | <span data-count="1">U</span>nreachable -&gt; Unexplored.zero
  | <span data-count="13">N</span>ot_explored -&gt; Unexplored.one

let update_unexplored tree = <span data-count="38">t</span>ree.unexplored &lt;- count_unexplore<span data-count="38">d</span> tree

let update_node tree node =
  <span data-count="7">t</span>ree.node &lt;- node;
  update_unexplored tree

let fresh_tree pc =
  <span data-count="18">{</span> node = Not_explored; unexplored = Unexplored.one; pc; ends = [] }

let new_node pc (head : Concolic_choice.pc_elt) : node =
  <span data-count="7">m</span>atch head with
  | <span data-count="7">S</span>elect (cond, _) -&gt;
    Select
      { cond
      ; if_true = fresh_tre<span data-count="7">e</span> (Select (cond, true) :: pc)
      ; if_false = fresh_tre<span data-count="7">e</span> (Select (cond, false) :: pc)
      }
  | <span data-count="0">S</span>elect_i32 (value, _) -&gt; Select_i32 { value; branches = IMap.empty }
  | <span data-count="0">A</span>ssume cond -&gt; Assume { cond; cont = fresh_tre<span data-count="0">e</span> (Assume cond :: pc) }
  | <span data-count="0">A</span>ssert cond -&gt;
    Assert { cond; cont = fresh_tre<span data-count="0">e</span> (Assert cond :: pc); disproved = None }

let try_initialize pc node head =
  <span data-count="17">m</span>atch node.node with
  | <span data-count="7">N</span>ot_explored -&gt; update_node node (new_nod<span data-count="7">e</span> pc head)
  | <span data-count="10">_</span> -&gt; ()

let check = true

let rec add_trace pc node (trace : trace) to_update : eval_tree list =
  <span data-count="31">m</span>atch trace.remaining_pc with
  | <span data-count="14">[</span>] -&gt; begin
    node.ends &lt;- (trace.end_of_trace, trace.assignments) :: node.ends;
    let () =
      match trace.end_of_trace with
      | <span data-count="1">T</span>rap Unreachable -&gt; begin
        match node.node with
        | <span data-count="1">N</span>ot_explored -&gt; node.node &lt;- Unreachable
        | <span data-count="0">U</span>nreachable -&gt; ()
        | _ -&gt; assert false
      end
      | <span data-count="13">_</span> -&gt; ()
    in
    node :: to_update
  end
  | <span data-count="17">h</span>ead_of_trace :: tail_of_trace -&gt; (
    try_initialize pc node head_of_trace;
    <span data-count="17">l</span>et pc = head_of_trace :: pc in
    match (node.node, head_of_trace) with
    | Not_explored, _ -&gt; assert false
    | Unreachable, _ -&gt; assert false
    | <span data-count="17">S</span>elect { cond; if_true; if_false }, Select (cond', v) -&gt;
      if check then assert <span data-count="34">(</span>Smtml.Expr.equa<span data-count="17">l</span> cond cond');
      <span data-count="17">l</span>et branch = if v then <span data-count="5">i</span>f_true else <span data-count="12">i</span>f_false in
      add_trace pc branch
        { trace with remaining_pc = tail_of_trace }
        (node :: to_update)
    | _, Select _ | Select _, _ -&gt; assert false
    | <span data-count="0">S</span>elect_i32 { value; branches }, Select_i32 (value', v) -&gt;
      if check then assert <span data-count="0">(</span>Smtml.Expr.equa<span data-count="0">l</span> value value');
      <span data-count="0">l</span>et branch =
        match IMap.find_opt v branches with
        | <span data-count="0">N</span>one -&gt;
          let t = fresh_tree pc in
          <span data-count="0">u</span>pdate_node node
            (Select_i32 { value; branches = IMap.ad<span data-count="0">d</span> v t branches });
          <span data-count="0">t</span>
        | <span data-count="0">S</span>ome t -&gt; t
      in
      add_trace pc branch
        { trace with remaining_pc = tail_of_trace }
        (node :: to_update)
    | _, Select_i32 _ | Select_i32 _, _ -&gt; assert false
    | <span data-count="0">A</span>ssume { cond; cont }, Assume cond' -&gt;
      if check then assert <span data-count="0">(</span>Smtml.Expr.equa<span data-count="0">l</span> cond cond');
      <span data-count="0">a</span>dd_trace pc cont
        { trace with remaining_pc = tail_of_trace }
        (node :: to_update)
    | _, Assume _ | Assume _, _ -&gt; assert false
    | <span data-count="0">A</span>ssert ({ cond; cont; disproved = _ } as assert_), Assert cond' -&gt;
      if check then assert <span data-count="0">(</span>Smtml.Expr.equa<span data-count="0">l</span> cond cond');
      <span data-count="0">b</span>egin
        match (tail_of_trace, trace.end_of_trace) with
        | <span data-count="0">[</span>], Assert_fail -&gt; assert_.disproved &lt;- Some trace.assignments
        | <span data-count="0">_</span> -&gt; ()
      end;
      add_trace pc cont
        { trace with remaining_pc = tail_of_trace }
        (node :: to_update) )

let add_trace tree trace =
  <span data-count="14">l</span>et to_update = add_trace [] tree trace [] in
  <span data-count="14">L</span>ist.iter update_unexplored to_update

let run_once tree link_state modules_to_run forced_values =
  <span data-count="14">l</span>et backups = List.map Concolic.backup modules_to_run in
  <span data-count="14">l</span>et result = run_modules_to_run link_state modules_to_run in
  <span data-count="14">l</span>et ( ( result
        , Choice.
            { pc
            ; symbols = _
            ; symbols_value
            ; shared = _
            ; preallocated_values = _
            } ) as r ) =
    let forced_values =
      match forced_values with <span data-count="0">N</span>one -&gt; Hashtbl.creat<span data-count="0">e</span> 0 | <span data-count="14">S</span>ome v -&gt; v
    in
    Choice.ru<span data-count="14">n</span> forced_values result
  in
  let () = List.iter2 Concolic.recover backups modules_to_run in
  <span data-count="14">l</span>et+ end_of_trace =
    match result with
    | <span data-count="11">O</span>k (Ok ()) -&gt; Ok Normal
    | <span data-count="0">O</span>k (Error _ as e) -&gt; e
    | <span data-count="1">E</span>rror (Trap t) -&gt; Ok (Trap t)
    | <span data-count="2">E</span>rror Assert_fail -&gt; Ok Assert_fail
    | <span data-count="0">E</span>rror (Assume_fail _c) -&gt; Ok Assume_fail
  in
  <span data-count="14">l</span>et trace =
    { assignments = symbols_value; remaining_pc = List.re<span data-count="14">v</span> pc; end_of_trace }
  in
  if debug then <span data-count="0">b</span>egin
    Fmt.pr "Add trace:@\n";
    <span data-count="0">F</span>mt.p<span data-count="0">r</span> "%a@\n" Concolic_choice.pp_pc trace.remaining_pc
  end;
  <span data-count="14">a</span>dd_trace tree trace;
  <span data-count="14">r</span>

(* Very naive ! *)
let rec find_node_to_run tree =
  <span data-count="24">m</span>atch tree.node with
  | <span data-count="14">N</span>ot_explored -&gt;
    if debug then begin
      <span data-count="0">F</span>mt.p<span data-count="0">r</span> "Try unexplored@.%a@.@." Concolic_choice.pp_pc tree.pc
    end;
    <span data-count="14">S</span>ome tree.pc
  | <span data-count="10">S</span>elect { cond = _; if_true; if_false } -&gt;
    let b =
      if Unexplored.none if_true.unexplored then <span data-count="0">f</span>alse
      else <span data-count="10">i</span>f Unexplored.none if_false.unexplored then <span data-count="0">t</span>rue
      else <span data-count="10">R</span>andom.boo<span data-count="10">l</span> ()
    in
    if debug then begin
      <span data-count="0">F</span>mt.p<span data-count="0">r</span> "Select bool %b@." b
    end;
    <span data-count="10">l</span>et tree = if b then <span data-count="5">i</span>f_true else <span data-count="5">i</span>f_false in
    find_node_to_run tree
  | <span data-count="0">S</span>elect_i32 { value = _; branches } -&gt;
    (* TODO: better ! *)
    let branches = IMap.bindings branches in
    <span data-count="0">l</span>et branches =
      List.filter (fun (_i, v) -&gt; <span data-count="0">n</span>ot (Unexplored.non<span data-count="0">e</span> v.unexplored)) branches
    in
    <span data-count="0">l</span>et n = List.length branches in
    <span data-count="0">i</span>f n = 0 then <span data-count="0">N</span>one
    else <span data-count="0">b</span>egin
      let i = Random.int n in
      <span data-count="0">l</span>et i, branch = List.nth branches i in
      <span data-count="0">i</span>f debug then begin
        <span data-count="0">F</span>mt.p<span data-count="0">r</span> "Select_i32 %li@." i
      end;
      <span data-count="0">f</span>ind_node_to_run branch
    end
  | <span data-count="0">A</span>ssume { cond = _; cont } -&gt; find_node_to_run cont
  | <span data-count="0">A</span>ssert { cond; cont = _; disproved = None } -&gt;
    let pc : Concolic_choice.pc = Select (cond, false) :: tree.pc in
    Fmt.pr "Try Assert@.%a@.@." Concolic_choice.pp_pc pc;
    <span data-count="0">S</span>ome pc
  | <span data-count="0">A</span>ssert { cond = _; cont; disproved = Some _ } -&gt; find_node_to_run cont
  | <span data-count="0">U</span>nreachable -&gt;
    Fmt.pr "Unreachable (Retry)@.%a@." Concolic_choice.pp_pc tree.pc;
    <span data-count="0">N</span>one

let pc_model solver pc =
  <span data-count="14">l</span>et pc = Concolic_choice.pc_to_exprs pc in
  <span data-count="14">m</span>atch Solver.check solver pc with
  | <span data-count="0">`</span>Unsat | <span data-count="0">`</span>Unknown -&gt; None
  | <span data-count="14">`</span>Sat -&gt;
    let symbols = None in
    let model = Solver.model ~symbols ~pc solver in
    <span data-count="14">S</span>ome model

let find_model_to_run solver tree =
  <span data-count="14">m</span>atch find_node_to_run tree with
  | <span data-count="0">N</span>one -&gt; None
  | <span data-count="14">S</span>ome pc -&gt; pc_model solver pc

let launch solver tree link_state modules_to_run =
  <span data-count="4">l</span>et rec find_model n =
    <span data-count="14">i</span>f n = 0 then <span data-count="0">b</span>egin
      Fmt.pr "Failed to find something to run@\n";
      <span data-count="0">N</span>one
    end
    else
      <span data-count="14">m</span>atch find_model_to_run solver tree with
      | <span data-count="0">N</span>one -&gt; find_model (n - 1)
      | <span data-count="14">S</span>ome m -&gt;
        if debug then begin
          <span data-count="0">F</span>mt.p<span data-count="0">r</span> "Found something to run %a@\n"
            (Smtml.Model.pp ~no_values:false)
            m
        end;
        <span data-count="14">S</span>ome m
  in
  let rec loop count : _ Result.t =
    <span data-count="15">i</span>f count &lt;= 0 then <span data-count="1">O</span>k None
    else
      <span data-count="14">l</span>et model = find_model 20 in
      <span data-count="14">r</span>un_model model count
  and run_model model count : _ Result.t =
    <span data-count="14">l</span>et* r, thread = run_onc<span data-count="14">e</span> tree link_state modules_to_run model in
    <span data-count="14">m</span>atch r with
    | <span data-count="11">O</span>k (Ok ()) -&gt; loop (count - 1)
    | <span data-count="0">O</span>k (Error _ as e) -&gt; e
    | <span data-count="0">E</span>rror (Assume_fail c) -&gt; begin
      if debug then <span data-count="0">b</span>egin
        Fmt.pr "Assume_fail: %a@\n" Smtml.Expr.pp c;
        <span data-count="0">F</span>mt.pr "Assignments:@\n%a@\n" Concolic_choice.pp_assignments
          thread.symbols_value;
        <span data-count="0">F</span>mt.p<span data-count="0">r</span> "Retry !@\n"
      end;
      <span data-count="0">m</span>atch pc_model solver thread.pc with
      | <span data-count="0">N</span>one -&gt;
        Fmt.epr "Can't satisfy assume !@\n";
        <span data-count="0">l</span>oop (count - 1)
      | <span data-count="0">S</span>ome _model as model -&gt; run_model model (count - 1)
    end
    | <span data-count="1">E</span>rror (Trap trap) -&gt; Ok (Some (`Trap trap, thread))
    | <span data-count="2">E</span>rror Assert_fail -&gt; Ok (Some (`Assert_fail, thread))
  in
  loop 10

(* NB: This function propagates potential errors (Result.err) occurring
   during evaluation (OS, syntax error, etc.), except for Trap and Assert,
   which are handled here. Most of the computations are done in the Result
   monad, hence the let*. *)
let cmd profiling debug unsafe optimize _workers _no_stop_at_failure no_values
  _deterministic_result_order _fail_mode (workspace : Fpath.t) solver files =
  <span data-count="4">i</span>f profiling then <span data-count="0">L</span>og.profiling_on := true;
  <span data-count="4">i</span>f debug then <span data-count="0">L</span>og.debug_on := true;

  (* deterministic_result_order implies no_stop_at_failure *)
  (* let no_stop_at_failure = deterministic_result_order || no_stop_at_failure in *)
  <span data-count="4">l</span>et* _created_dir = Bos.OS.Dir.creat<span data-count="4">e</span> ~path:true ~mode:0o755 workspace in
  <span data-count="4">l</span>et solver = Solver.fresh solver () in
  <span data-count="4">l</span>et* link_state, modules_to_run =
    simplify_then_link_file<span data-count="4">s</span> ~unsafe ~optimize files
  in
  <span data-count="4">l</span>et tree = fresh_tree [] in
  <span data-count="4">l</span>et* result = launc<span data-count="4">h</span> solver tree link_state modules_to_run in

  <span data-count="4">l</span>et print_pc pc =
    <span data-count="0">F</span>mt.pr "PC:@\n";
    <span data-count="0">F</span>mt.pr "%a@\n" Concolic_choice.pp_pc pc
  in
  let print_values symbols_value =
    <span data-count="0">F</span>mt.pr "Assignments:@\n";
    <span data-count="0">L</span>ist.iter
      (fun (s, v) -&gt; <span data-count="0">F</span>mt.pr "  %a: %a" Smtml.Symbol.pp s Concrete_value.pp v)
      symbols_value;
    <span data-count="0">F</span>mt.pr "@\n"
  in

  let testcase model =
    <span data-count="3">i</span>f not no_values then
      <span data-count="2">l</span>et testcase = Smtml.Model.get_bindings model |&gt; <span data-count="2">L</span>ist.map snd in
      <span data-count="2">C</span>md_utils.write_testcase ~dir:workspace testcase
    else <span data-count="1">O</span>k ()
  in

  match result with
  | <span data-count="1">N</span>one -&gt;
    Fmt.pr "OK@\n";
    <span data-count="1">O</span>k ()
  | <span data-count="1">S</span>ome (`Trap trap, thread) -&gt;
    Fmt.pr "Trap: %s@\n" (Trap.to_strin<span data-count="1">g</span> trap);
    <span data-count="1">i</span>f debug then <span data-count="0">b</span>egin
      print_pc thread.pc;
      <span data-count="0">p</span>rint_value<span data-count="0">s</span> thread.symbols_value
    end;
    <span data-count="1">l</span>et symbols = None in
    let model = get_model ~symbols solver thread.pc in
    <span data-count="1">F</span>mt.pr "Model:@\n  @[&lt;v&gt;%a@]@." (Smtml.Model.pp ~no_values) model;
    <span data-count="1">l</span>et* () = testcas<span data-count="1">e</span> model in
    <span data-count="1">E</span>rror (`Found_bug 1)
  | <span data-count="2">S</span>ome (`Assert_fail, thread) -&gt;
    Fmt.pr "Assert failure@\n";
    <span data-count="2">i</span>f debug then <span data-count="0">b</span>egin
      print_pc thread.pc;
      <span data-count="0">p</span>rint_value<span data-count="0">s</span> thread.symbols_value
    end;
    <span data-count="2">l</span>et symbols = None in
    let model = get_model ~symbols solver thread.pc in
    <span data-count="2">F</span>mt.pr "Model:@\n  @[&lt;v&gt;%a@]@." (Smtml.Model.pp ~no_values) model;
    <span data-count="2">l</span>et* () = testcas<span data-count="2">e</span> model in
    <span data-count="2">E</span>rror (`Found_bug 1)
</code></pre>
      </div>
    </div>
    <script src="../../coverage.js"></script>
  </body>
</html>
