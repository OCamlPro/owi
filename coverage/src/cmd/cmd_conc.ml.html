<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="utf-8"/>
    <title>cmd_conc.ml &mdash; Coverage report</title>
    <meta name="description" content="86.55% coverage in src/cmd/cmd_conc.ml">
    <link rel="stylesheet" href="../../coverage.css"/>
    <script src="../../highlight.pack.js"></script>
    <script>hljs.initHighlightingOnLoad();</script>
  </head>
  <body>
    <div id="header">
      <h1>
        <a href="../../index.html">
          <span class="dirname">src/cmd/</span>cmd_conc.ml
        </a>
      </h1>
      <h2>86.55%</h2>
    </div>
    <div id="navbar">
      <span class="some-visited" style="top:3.50%"></span>
      <span class="unvisited" style="top:5.06%"></span>
      <span class="unvisited" style="top:28.60%"></span>
      <span class="unvisited" style="top:28.79%"></span>
      <span class="unvisited" style="top:28.99%"></span>
      <span class="unvisited" style="top:29.18%"></span>
      <span class="unvisited" style="top:29.38%"></span>
      <span class="unvisited" style="top:29.57%"></span>
      <span class="unvisited" style="top:29.77%"></span>
      <span class="unvisited" style="top:29.96%"></span>
      <span class="unvisited" style="top:37.16%"></span>
      <span class="some-visited" style="top:42.22%"></span>
      <span class="unvisited" style="bottom:44.16%"></span>
      <span class="unvisited" style="bottom:43.39%"></span>
      <span class="some-visited" style="bottom:36.58%"></span>
      <span class="some-visited" style="bottom:32.88%"></span>
      <span class="some-visited" style="bottom:31.52%"></span>
      <span class="unvisited" style="bottom:23.15%"></span>
      <span class="unvisited" style="bottom:19.46%"></span>
      <span class="unvisited" style="bottom:15.56%"></span>
      <span class="unvisited" style="bottom:15.37%"></span>
      <span class="unvisited" style="bottom:15.18%"></span>
      <span class="some-visited" style="bottom:10.70%"></span>
      <span class="some-visited" style="bottom:10.51%"></span>
      <span class="unvisited" style="bottom:9.34%"></span>
      <span class="unvisited" style="bottom:6.03%"></span>
      <span class="unvisited" style="bottom:5.84%"></span>
      <span class="unvisited" style="bottom:5.64%"></span>
      <span class="unvisited" style="bottom:4.28%"></span>
      <span class="unvisited" style="bottom:1.56%"></span>
    </div>
    <div id="report">
      <div id="lines-layer">
        <pre>
<a id="L1"></a><span > </span>
<a id="L2"></a><span > </span>
<a id="L3"></a><span > </span>
<a id="L4"></a><span > </span>
<a id="L5"></a><span > </span>
<a id="L6"></a><span > </span>
<a id="L7"></a><span > </span>
<a id="L8"></a><span > </span>
<a id="L9"></a><span > </span>
<a id="L10"></a><span class="visited"> </span>
<a id="L11"></a><span > </span>
<a id="L12"></a><span > </span>
<a id="L13"></a><span > </span>
<a id="L14"></a><span > </span>
<a id="L15"></a><span > </span>
<a id="L16"></a><span > </span>
<a id="L17"></a><span class="visited"> </span>
<a id="L18"></a><span class="some-visited"> </span>
<a id="L19"></a><span > </span>
<a id="L20"></a><span > </span>
<a id="L21"></a><span > </span>
<a id="L22"></a><span class="visited"> </span>
<a id="L23"></a><span > </span>
<a id="L24"></a><span class="visited"> </span>
<a id="L25"></a><span class="visited"> </span>
<a id="L26"></a><span class="unvisited"> </span>
<a id="L27"></a><span > </span>
<a id="L28"></a><span > </span>
<a id="L29"></a><span class="visited"> </span>
<a id="L30"></a><span class="visited"> </span>
<a id="L31"></a><span class="visited"> </span>
<a id="L32"></a><span > </span>
<a id="L33"></a><span class="visited"> </span>
<a id="L34"></a><span class="visited"> </span>
<a id="L35"></a><span > </span>
<a id="L36"></a><span > </span>
<a id="L37"></a><span > </span>
<a id="L38"></a><span class="visited"> </span>
<a id="L39"></a><span > </span>
<a id="L40"></a><span > </span>
<a id="L41"></a><span > </span>
<a id="L42"></a><span > </span>
<a id="L43"></a><span > </span>
<a id="L44"></a><span class="visited"> </span>
<a id="L45"></a><span > </span>
<a id="L46"></a><span > </span>
<a id="L47"></a><span > </span>
<a id="L48"></a><span > </span>
<a id="L49"></a><span class="visited"> </span>
<a id="L50"></a><span class="visited"> </span>
<a id="L51"></a><span > </span>
<a id="L52"></a><span class="visited"> </span>
<a id="L53"></a><span class="visited"> </span>
<a id="L54"></a><span class="visited"> </span>
<a id="L55"></a><span class="visited"> </span>
<a id="L56"></a><span > </span>
<a id="L57"></a><span > </span>
<a id="L58"></a><span class="visited"> </span>
<a id="L59"></a><span > </span>
<a id="L60"></a><span > </span>
<a id="L61"></a><span > </span>
<a id="L62"></a><span class="visited"> </span>
<a id="L63"></a><span > </span>
<a id="L64"></a><span > </span>
<a id="L65"></a><span class="visited"> </span>
<a id="L66"></a><span > </span>
<a id="L67"></a><span class="visited"> </span>
<a id="L68"></a><span class="visited"> </span>
<a id="L69"></a><span class="visited"> </span>
<a id="L70"></a><span > </span>
<a id="L71"></a><span > </span>
<a id="L72"></a><span > </span>
<a id="L73"></a><span > </span>
<a id="L74"></a><span > </span>
<a id="L75"></a><span > </span>
<a id="L76"></a><span > </span>
<a id="L77"></a><span > </span>
<a id="L78"></a><span > </span>
<a id="L79"></a><span > </span>
<a id="L80"></a><span > </span>
<a id="L81"></a><span > </span>
<a id="L82"></a><span > </span>
<a id="L83"></a><span > </span>
<a id="L84"></a><span > </span>
<a id="L85"></a><span > </span>
<a id="L86"></a><span > </span>
<a id="L87"></a><span > </span>
<a id="L88"></a><span > </span>
<a id="L89"></a><span > </span>
<a id="L90"></a><span > </span>
<a id="L91"></a><span > </span>
<a id="L92"></a><span > </span>
<a id="L93"></a><span > </span>
<a id="L94"></a><span > </span>
<a id="L95"></a><span > </span>
<a id="L96"></a><span > </span>
<a id="L97"></a><span > </span>
<a id="L98"></a><span class="visited"> </span>
<a id="L99"></a><span > </span>
<a id="L100"></a><span > </span>
<a id="L101"></a><span > </span>
<a id="L102"></a><span > </span>
<a id="L103"></a><span > </span>
<a id="L104"></a><span class="visited"> </span>
<a id="L105"></a><span > </span>
<a id="L106"></a><span > </span>
<a id="L107"></a><span > </span>
<a id="L108"></a><span > </span>
<a id="L109"></a><span > </span>
<a id="L110"></a><span > </span>
<a id="L111"></a><span > </span>
<a id="L112"></a><span > </span>
<a id="L113"></a><span > </span>
<a id="L114"></a><span > </span>
<a id="L115"></a><span > </span>
<a id="L116"></a><span > </span>
<a id="L117"></a><span > </span>
<a id="L118"></a><span > </span>
<a id="L119"></a><span > </span>
<a id="L120"></a><span > </span>
<a id="L121"></a><span > </span>
<a id="L122"></a><span > </span>
<a id="L123"></a><span > </span>
<a id="L124"></a><span > </span>
<a id="L125"></a><span > </span>
<a id="L126"></a><span > </span>
<a id="L127"></a><span > </span>
<a id="L128"></a><span > </span>
<a id="L129"></a><span > </span>
<a id="L130"></a><span > </span>
<a id="L131"></a><span > </span>
<a id="L132"></a><span > </span>
<a id="L133"></a><span > </span>
<a id="L134"></a><span > </span>
<a id="L135"></a><span > </span>
<a id="L136"></a><span > </span>
<a id="L137"></a><span > </span>
<a id="L138"></a><span > </span>
<a id="L139"></a><span > </span>
<a id="L140"></a><span > </span>
<a id="L141"></a><span > </span>
<a id="L142"></a><span > </span>
<a id="L143"></a><span > </span>
<a id="L144"></a><span > </span>
<a id="L145"></a><span > </span>
<a id="L146"></a><span > </span>
<a id="L147"></a><span class="unvisited"> </span>
<a id="L148"></a><span class="unvisited"> </span>
<a id="L149"></a><span class="unvisited"> </span>
<a id="L150"></a><span class="unvisited"> </span>
<a id="L151"></a><span class="unvisited"> </span>
<a id="L152"></a><span class="unvisited"> </span>
<a id="L153"></a><span class="unvisited"> </span>
<a id="L154"></a><span class="unvisited"> </span>
<a id="L155"></a><span > </span>
<a id="L156"></a><span > </span>
<a id="L157"></a><span > </span>
<a id="L158"></a><span > </span>
<a id="L159"></a><span class="visited"> </span>
<a id="L160"></a><span class="visited"> </span>
<a id="L161"></a><span > </span>
<a id="L162"></a><span class="visited"> </span>
<a id="L163"></a><span > </span>
<a id="L164"></a><span class="visited"> </span>
<a id="L165"></a><span > </span>
<a id="L166"></a><span class="visited"> </span>
<a id="L167"></a><span class="visited"> </span>
<a id="L168"></a><span class="visited"> </span>
<a id="L169"></a><span > </span>
<a id="L170"></a><span class="visited"> </span>
<a id="L171"></a><span > </span>
<a id="L172"></a><span > </span>
<a id="L173"></a><span class="visited"> </span>
<a id="L174"></a><span > </span>
<a id="L175"></a><span > </span>
<a id="L176"></a><span > </span>
<a id="L177"></a><span class="visited"> </span>
<a id="L178"></a><span > </span>
<a id="L179"></a><span > </span>
<a id="L180"></a><span class="visited"> </span>
<a id="L181"></a><span class="visited"> </span>
<a id="L182"></a><span > </span>
<a id="L183"></a><span > </span>
<a id="L184"></a><span class="visited"> </span>
<a id="L185"></a><span class="visited"> </span>
<a id="L186"></a><span > </span>
<a id="L187"></a><span class="visited"> </span>
<a id="L188"></a><span class="visited"> </span>
<a id="L189"></a><span class="visited"> </span>
<a id="L190"></a><span class="visited"> </span>
<a id="L191"></a><span class="unvisited"> </span>
<a id="L192"></a><span > </span>
<a id="L193"></a><span > </span>
<a id="L194"></a><span > </span>
<a id="L195"></a><span class="visited"> </span>
<a id="L196"></a><span class="visited"> </span>
<a id="L197"></a><span class="visited"> </span>
<a id="L198"></a><span > </span>
<a id="L199"></a><span > </span>
<a id="L200"></a><span > </span>
<a id="L201"></a><span > </span>
<a id="L202"></a><span class="visited"> </span>
<a id="L203"></a><span class="visited"> </span>
<a id="L204"></a><span > </span>
<a id="L205"></a><span > </span>
<a id="L206"></a><span > </span>
<a id="L207"></a><span > </span>
<a id="L208"></a><span class="visited"> </span>
<a id="L209"></a><span class="visited"> </span>
<a id="L210"></a><span > </span>
<a id="L211"></a><span > </span>
<a id="L212"></a><span class="visited"> </span>
<a id="L213"></a><span class="visited"> </span>
<a id="L214"></a><span > </span>
<a id="L215"></a><span > </span>
<a id="L216"></a><span class="visited"> </span>
<a id="L217"></a><span class="some-visited"> </span>
<a id="L218"></a><span > </span>
<a id="L219"></a><span > </span>
<a id="L220"></a><span > </span>
<a id="L221"></a><span > </span>
<a id="L222"></a><span class="visited"> </span>
<a id="L223"></a><span > </span>
<a id="L224"></a><span class="visited"> </span>
<a id="L225"></a><span > </span>
<a id="L226"></a><span > </span>
<a id="L227"></a><span > </span>
<a id="L228"></a><span > </span>
<a id="L229"></a><span class="visited"> </span>
<a id="L230"></a><span class="visited"> </span>
<a id="L231"></a><span class="visited"> </span>
<a id="L232"></a><span > </span>
<a id="L233"></a><span > </span>
<a id="L234"></a><span > </span>
<a id="L235"></a><span > </span>
<a id="L236"></a><span class="visited"> </span>
<a id="L237"></a><span class="visited"> </span>
<a id="L238"></a><span class="visited"> </span>
<a id="L239"></a><span > </span>
<a id="L240"></a><span class="visited"> </span>
<a id="L241"></a><span > </span>
<a id="L242"></a><span class="visited"> </span>
<a id="L243"></a><span class="visited"> </span>
<a id="L244"></a><span class="visited"> </span>
<a id="L245"></a><span class="visited"> </span>
<a id="L246"></a><span > </span>
<a id="L247"></a><span > </span>
<a id="L248"></a><span > </span>
<a id="L249"></a><span > </span>
<a id="L250"></a><span > </span>
<a id="L251"></a><span class="visited"> </span>
<a id="L252"></a><span class="visited"> </span>
<a id="L253"></a><span class="visited"> </span>
<a id="L254"></a><span > </span>
<a id="L255"></a><span > </span>
<a id="L256"></a><span > </span>
<a id="L257"></a><span class="visited"> </span>
<a id="L258"></a><span class="visited"> </span>
<a id="L259"></a><span class="visited"> </span>
<a id="L260"></a><span class="visited"> </span>
<a id="L261"></a><span class="visited"> </span>
<a id="L262"></a><span > </span>
<a id="L263"></a><span > </span>
<a id="L264"></a><span > </span>
<a id="L265"></a><span > </span>
<a id="L266"></a><span > </span>
<a id="L267"></a><span class="visited"> </span>
<a id="L268"></a><span class="visited"> </span>
<a id="L269"></a><span > </span>
<a id="L270"></a><span > </span>
<a id="L271"></a><span class="visited"> </span>
<a id="L272"></a><span class="visited"> </span>
<a id="L273"></a><span class="visited"> </span>
<a id="L274"></a><span > </span>
<a id="L275"></a><span > </span>
<a id="L276"></a><span > </span>
<a id="L277"></a><span > </span>
<a id="L278"></a><span > </span>
<a id="L279"></a><span > </span>
<a id="L280"></a><span > </span>
<a id="L281"></a><span > </span>
<a id="L282"></a><span > </span>
<a id="L283"></a><span class="visited"> </span>
<a id="L284"></a><span class="visited"> </span>
<a id="L285"></a><span > </span>
<a id="L286"></a><span class="visited"> </span>
<a id="L287"></a><span class="unvisited"> </span>
<a id="L288"></a><span class="visited"> </span>
<a id="L289"></a><span class="visited"> </span>
<a id="L290"></a><span class="visited"> </span>
<a id="L291"></a><span class="unvisited"> </span>
<a id="L292"></a><span > </span>
<a id="L293"></a><span class="visited"> </span>
<a id="L294"></a><span class="visited"> </span>
<a id="L295"></a><span > </span>
<a id="L296"></a><span > </span>
<a id="L297"></a><span > </span>
<a id="L298"></a><span > </span>
<a id="L299"></a><span > </span>
<a id="L300"></a><span class="visited"> </span>
<a id="L301"></a><span > </span>
<a id="L302"></a><span class="visited"> </span>
<a id="L303"></a><span class="visited"> </span>
<a id="L304"></a><span > </span>
<a id="L305"></a><span class="visited"> </span>
<a id="L306"></a><span class="visited"> </span>
<a id="L307"></a><span > </span>
<a id="L308"></a><span > </span>
<a id="L309"></a><span class="visited"> </span>
<a id="L310"></a><span class="visited"> </span>
<a id="L311"></a><span > </span>
<a id="L312"></a><span class="visited"> </span>
<a id="L313"></a><span class="visited"> </span>
<a id="L314"></a><span class="visited"> </span>
<a id="L315"></a><span class="visited"> </span>
<a id="L316"></a><span > </span>
<a id="L317"></a><span class="visited"> </span>
<a id="L318"></a><span class="visited"> </span>
<a id="L319"></a><span class="visited"> </span>
<a id="L320"></a><span > </span>
<a id="L321"></a><span > </span>
<a id="L322"></a><span class="visited"> </span>
<a id="L323"></a><span class="visited"> </span>
<a id="L324"></a><span > </span>
<a id="L325"></a><span class="visited"> </span>
<a id="L326"></a><span class="some-visited"> </span>
<a id="L327"></a><span class="visited"> </span>
<a id="L328"></a><span > </span>
<a id="L329"></a><span > </span>
<a id="L330"></a><span class="visited"> </span>
<a id="L331"></a><span > </span>
<a id="L332"></a><span class="visited"> </span>
<a id="L333"></a><span > </span>
<a id="L334"></a><span class="visited"> </span>
<a id="L335"></a><span > </span>
<a id="L336"></a><span class="visited"> </span>
<a id="L337"></a><span class="visited"> </span>
<a id="L338"></a><span > </span>
<a id="L339"></a><span > </span>
<a id="L340"></a><span class="visited"> </span>
<a id="L341"></a><span class="visited"> </span>
<a id="L342"></a><span class="visited"> </span>
<a id="L343"></a><span > </span>
<a id="L344"></a><span class="visited"> </span>
<a id="L345"></a><span class="some-visited"> </span>
<a id="L346"></a><span > </span>
<a id="L347"></a><span > </span>
<a id="L348"></a><span > </span>
<a id="L349"></a><span > </span>
<a id="L350"></a><span class="visited"> </span>
<a id="L351"></a><span class="visited"> </span>
<a id="L352"></a><span class="some-visited"> </span>
<a id="L353"></a><span class="visited"> </span>
<a id="L354"></a><span class="visited"> </span>
<a id="L355"></a><span class="visited"> </span>
<a id="L356"></a><span > </span>
<a id="L357"></a><span > </span>
<a id="L358"></a><span class="visited"> </span>
<a id="L359"></a><span class="visited"> </span>
<a id="L360"></a><span class="visited"> </span>
<a id="L361"></a><span > </span>
<a id="L362"></a><span > </span>
<a id="L363"></a><span > </span>
<a id="L364"></a><span class="visited"> </span>
<a id="L365"></a><span > </span>
<a id="L366"></a><span class="visited"> </span>
<a id="L367"></a><span > </span>
<a id="L368"></a><span class="visited"> </span>
<a id="L369"></a><span class="visited"> </span>
<a id="L370"></a><span > </span>
<a id="L371"></a><span class="visited"> </span>
<a id="L372"></a><span class="visited"> </span>
<a id="L373"></a><span > </span>
<a id="L374"></a><span class="visited"> </span>
<a id="L375"></a><span class="visited"> </span>
<a id="L376"></a><span > </span>
<a id="L377"></a><span > </span>
<a id="L378"></a><span > </span>
<a id="L379"></a><span > </span>
<a id="L380"></a><span > </span>
<a id="L381"></a><span class="visited"> </span>
<a id="L382"></a><span > </span>
<a id="L383"></a><span > </span>
<a id="L384"></a><span > </span>
<a id="L385"></a><span > </span>
<a id="L386"></a><span > </span>
<a id="L387"></a><span class="visited"> </span>
<a id="L388"></a><span class="visited"> </span>
<a id="L389"></a><span class="visited"> </span>
<a id="L390"></a><span class="visited"> </span>
<a id="L391"></a><span class="visited"> </span>
<a id="L392"></a><span class="visited"> </span>
<a id="L393"></a><span > </span>
<a id="L394"></a><span class="visited"> </span>
<a id="L395"></a><span class="unvisited"> </span>
<a id="L396"></a><span class="visited"> </span>
<a id="L397"></a><span > </span>
<a id="L398"></a><span > </span>
<a id="L399"></a><span class="visited"> </span>
<a id="L400"></a><span class="visited"> </span>
<a id="L401"></a><span class="visited"> </span>
<a id="L402"></a><span > </span>
<a id="L403"></a><span > </span>
<a id="L404"></a><span class="visited"> </span>
<a id="L405"></a><span class="visited"> </span>
<a id="L406"></a><span class="visited"> </span>
<a id="L407"></a><span class="visited"> </span>
<a id="L408"></a><span class="visited"> </span>
<a id="L409"></a><span > </span>
<a id="L410"></a><span > </span>
<a id="L411"></a><span class="visited"> </span>
<a id="L412"></a><span > </span>
<a id="L413"></a><span > </span>
<a id="L414"></a><span class="unvisited"> </span>
<a id="L415"></a><span > </span>
<a id="L416"></a><span class="visited"> </span>
<a id="L417"></a><span class="visited"> </span>
<a id="L418"></a><span class="visited"> </span>
<a id="L419"></a><span > </span>
<a id="L420"></a><span > </span>
<a id="L421"></a><span class="visited"> </span>
<a id="L422"></a><span class="visited"> </span>
<a id="L423"></a><span > </span>
<a id="L424"></a><span > </span>
<a id="L425"></a><span > </span>
<a id="L426"></a><span > </span>
<a id="L427"></a><span > </span>
<a id="L428"></a><span class="visited"> </span>
<a id="L429"></a><span class="visited"> </span>
<a id="L430"></a><span > </span>
<a id="L431"></a><span class="visited"> </span>
<a id="L432"></a><span > </span>
<a id="L433"></a><span class="visited"> </span>
<a id="L434"></a><span class="unvisited"> </span>
<a id="L435"></a><span class="unvisited"> </span>
<a id="L436"></a><span class="unvisited"> </span>
<a id="L437"></a><span > </span>
<a id="L438"></a><span > </span>
<a id="L439"></a><span > </span>
<a id="L440"></a><span > </span>
<a id="L441"></a><span class="visited"> </span>
<a id="L442"></a><span > </span>
<a id="L443"></a><span > </span>
<a id="L444"></a><span > </span>
<a id="L445"></a><span > </span>
<a id="L446"></a><span > </span>
<a id="L447"></a><span > </span>
<a id="L448"></a><span > </span>
<a id="L449"></a><span > </span>
<a id="L450"></a><span > </span>
<a id="L451"></a><span class="visited"> </span>
<a id="L452"></a><span > </span>
<a id="L453"></a><span class="visited"> </span>
<a id="L454"></a><span class="visited"> </span>
<a id="L455"></a><span > </span>
<a id="L456"></a><span class="visited"> </span>
<a id="L457"></a><span > </span>
<a id="L458"></a><span class="visited"> </span>
<a id="L459"></a><span class="some-visited"> </span>
<a id="L460"></a><span class="some-visited"> </span>
<a id="L461"></a><span > </span>
<a id="L462"></a><span > </span>
<a id="L463"></a><span class="visited"> </span>
<a id="L464"></a><span class="visited"> </span>
<a id="L465"></a><span class="visited"> </span>
<a id="L466"></a><span class="unvisited"> </span>
<a id="L467"></a><span class="visited"> </span>
<a id="L468"></a><span > </span>
<a id="L469"></a><span > </span>
<a id="L470"></a><span class="visited"> </span>
<a id="L471"></a><span class="visited"> </span>
<a id="L472"></a><span > </span>
<a id="L473"></a><span > </span>
<a id="L474"></a><span class="visited"> </span>
<a id="L475"></a><span class="visited"> </span>
<a id="L476"></a><span class="visited"> </span>
<a id="L477"></a><span class="visited"> </span>
<a id="L478"></a><span class="visited"> </span>
<a id="L479"></a><span class="visited"> </span>
<a id="L480"></a><span > </span>
<a id="L481"></a><span class="visited"> </span>
<a id="L482"></a><span class="visited"> </span>
<a id="L483"></a><span class="unvisited"> </span>
<a id="L484"></a><span class="unvisited"> </span>
<a id="L485"></a><span class="unvisited"> </span>
<a id="L486"></a><span > </span>
<a id="L487"></a><span > </span>
<a id="L488"></a><span > </span>
<a id="L489"></a><span > </span>
<a id="L490"></a><span class="visited"> </span>
<a id="L491"></a><span > </span>
<a id="L492"></a><span class="unvisited"> </span>
<a id="L493"></a><span class="visited"> </span>
<a id="L494"></a><span class="visited"> </span>
<a id="L495"></a><span > </span>
<a id="L496"></a><span class="visited"> </span>
<a id="L497"></a><span class="visited"> </span>
<a id="L498"></a><span > </span>
<a id="L499"></a><span class="visited"> </span>
<a id="L500"></a><span class="visited"> </span>
<a id="L501"></a><span class="visited"> </span>
<a id="L502"></a><span class="visited"> </span>
<a id="L503"></a><span class="visited"> </span>
<a id="L504"></a><span > </span>
<a id="L505"></a><span class="visited"> </span>
<a id="L506"></a><span class="unvisited"> </span>
<a id="L507"></a><span > </span>
<a id="L508"></a><span > </span>
<a id="L509"></a><span > </span>
<a id="L510"></a><span class="visited"> </span>
<a id="L511"></a><span > </span>
<a id="L512"></a><span class="visited"> </span>
<a id="L513"></a><span class="visited"> </span>
<a id="L514"></a><span class="visited"> </span>
</pre>
      </div>
      <div id="text-layer">
        <pre id="line-numbers">
<a href="#L1">  1</a>
<a href="#L2">  2</a>
<a href="#L3">  3</a>
<a href="#L4">  4</a>
<a href="#L5">  5</a>
<a href="#L6">  6</a>
<a href="#L7">  7</a>
<a href="#L8">  8</a>
<a href="#L9">  9</a>
<a href="#L10"> 10</a>
<a href="#L11"> 11</a>
<a href="#L12"> 12</a>
<a href="#L13"> 13</a>
<a href="#L14"> 14</a>
<a href="#L15"> 15</a>
<a href="#L16"> 16</a>
<a href="#L17"> 17</a>
<a href="#L18"> 18</a>
<a href="#L19"> 19</a>
<a href="#L20"> 20</a>
<a href="#L21"> 21</a>
<a href="#L22"> 22</a>
<a href="#L23"> 23</a>
<a href="#L24"> 24</a>
<a href="#L25"> 25</a>
<a href="#L26"> 26</a>
<a href="#L27"> 27</a>
<a href="#L28"> 28</a>
<a href="#L29"> 29</a>
<a href="#L30"> 30</a>
<a href="#L31"> 31</a>
<a href="#L32"> 32</a>
<a href="#L33"> 33</a>
<a href="#L34"> 34</a>
<a href="#L35"> 35</a>
<a href="#L36"> 36</a>
<a href="#L37"> 37</a>
<a href="#L38"> 38</a>
<a href="#L39"> 39</a>
<a href="#L40"> 40</a>
<a href="#L41"> 41</a>
<a href="#L42"> 42</a>
<a href="#L43"> 43</a>
<a href="#L44"> 44</a>
<a href="#L45"> 45</a>
<a href="#L46"> 46</a>
<a href="#L47"> 47</a>
<a href="#L48"> 48</a>
<a href="#L49"> 49</a>
<a href="#L50"> 50</a>
<a href="#L51"> 51</a>
<a href="#L52"> 52</a>
<a href="#L53"> 53</a>
<a href="#L54"> 54</a>
<a href="#L55"> 55</a>
<a href="#L56"> 56</a>
<a href="#L57"> 57</a>
<a href="#L58"> 58</a>
<a href="#L59"> 59</a>
<a href="#L60"> 60</a>
<a href="#L61"> 61</a>
<a href="#L62"> 62</a>
<a href="#L63"> 63</a>
<a href="#L64"> 64</a>
<a href="#L65"> 65</a>
<a href="#L66"> 66</a>
<a href="#L67"> 67</a>
<a href="#L68"> 68</a>
<a href="#L69"> 69</a>
<a href="#L70"> 70</a>
<a href="#L71"> 71</a>
<a href="#L72"> 72</a>
<a href="#L73"> 73</a>
<a href="#L74"> 74</a>
<a href="#L75"> 75</a>
<a href="#L76"> 76</a>
<a href="#L77"> 77</a>
<a href="#L78"> 78</a>
<a href="#L79"> 79</a>
<a href="#L80"> 80</a>
<a href="#L81"> 81</a>
<a href="#L82"> 82</a>
<a href="#L83"> 83</a>
<a href="#L84"> 84</a>
<a href="#L85"> 85</a>
<a href="#L86"> 86</a>
<a href="#L87"> 87</a>
<a href="#L88"> 88</a>
<a href="#L89"> 89</a>
<a href="#L90"> 90</a>
<a href="#L91"> 91</a>
<a href="#L92"> 92</a>
<a href="#L93"> 93</a>
<a href="#L94"> 94</a>
<a href="#L95"> 95</a>
<a href="#L96"> 96</a>
<a href="#L97"> 97</a>
<a href="#L98"> 98</a>
<a href="#L99"> 99</a>
<a href="#L100">100</a>
<a href="#L101">101</a>
<a href="#L102">102</a>
<a href="#L103">103</a>
<a href="#L104">104</a>
<a href="#L105">105</a>
<a href="#L106">106</a>
<a href="#L107">107</a>
<a href="#L108">108</a>
<a href="#L109">109</a>
<a href="#L110">110</a>
<a href="#L111">111</a>
<a href="#L112">112</a>
<a href="#L113">113</a>
<a href="#L114">114</a>
<a href="#L115">115</a>
<a href="#L116">116</a>
<a href="#L117">117</a>
<a href="#L118">118</a>
<a href="#L119">119</a>
<a href="#L120">120</a>
<a href="#L121">121</a>
<a href="#L122">122</a>
<a href="#L123">123</a>
<a href="#L124">124</a>
<a href="#L125">125</a>
<a href="#L126">126</a>
<a href="#L127">127</a>
<a href="#L128">128</a>
<a href="#L129">129</a>
<a href="#L130">130</a>
<a href="#L131">131</a>
<a href="#L132">132</a>
<a href="#L133">133</a>
<a href="#L134">134</a>
<a href="#L135">135</a>
<a href="#L136">136</a>
<a href="#L137">137</a>
<a href="#L138">138</a>
<a href="#L139">139</a>
<a href="#L140">140</a>
<a href="#L141">141</a>
<a href="#L142">142</a>
<a href="#L143">143</a>
<a href="#L144">144</a>
<a href="#L145">145</a>
<a href="#L146">146</a>
<a href="#L147">147</a>
<a href="#L148">148</a>
<a href="#L149">149</a>
<a href="#L150">150</a>
<a href="#L151">151</a>
<a href="#L152">152</a>
<a href="#L153">153</a>
<a href="#L154">154</a>
<a href="#L155">155</a>
<a href="#L156">156</a>
<a href="#L157">157</a>
<a href="#L158">158</a>
<a href="#L159">159</a>
<a href="#L160">160</a>
<a href="#L161">161</a>
<a href="#L162">162</a>
<a href="#L163">163</a>
<a href="#L164">164</a>
<a href="#L165">165</a>
<a href="#L166">166</a>
<a href="#L167">167</a>
<a href="#L168">168</a>
<a href="#L169">169</a>
<a href="#L170">170</a>
<a href="#L171">171</a>
<a href="#L172">172</a>
<a href="#L173">173</a>
<a href="#L174">174</a>
<a href="#L175">175</a>
<a href="#L176">176</a>
<a href="#L177">177</a>
<a href="#L178">178</a>
<a href="#L179">179</a>
<a href="#L180">180</a>
<a href="#L181">181</a>
<a href="#L182">182</a>
<a href="#L183">183</a>
<a href="#L184">184</a>
<a href="#L185">185</a>
<a href="#L186">186</a>
<a href="#L187">187</a>
<a href="#L188">188</a>
<a href="#L189">189</a>
<a href="#L190">190</a>
<a href="#L191">191</a>
<a href="#L192">192</a>
<a href="#L193">193</a>
<a href="#L194">194</a>
<a href="#L195">195</a>
<a href="#L196">196</a>
<a href="#L197">197</a>
<a href="#L198">198</a>
<a href="#L199">199</a>
<a href="#L200">200</a>
<a href="#L201">201</a>
<a href="#L202">202</a>
<a href="#L203">203</a>
<a href="#L204">204</a>
<a href="#L205">205</a>
<a href="#L206">206</a>
<a href="#L207">207</a>
<a href="#L208">208</a>
<a href="#L209">209</a>
<a href="#L210">210</a>
<a href="#L211">211</a>
<a href="#L212">212</a>
<a href="#L213">213</a>
<a href="#L214">214</a>
<a href="#L215">215</a>
<a href="#L216">216</a>
<a href="#L217">217</a>
<a href="#L218">218</a>
<a href="#L219">219</a>
<a href="#L220">220</a>
<a href="#L221">221</a>
<a href="#L222">222</a>
<a href="#L223">223</a>
<a href="#L224">224</a>
<a href="#L225">225</a>
<a href="#L226">226</a>
<a href="#L227">227</a>
<a href="#L228">228</a>
<a href="#L229">229</a>
<a href="#L230">230</a>
<a href="#L231">231</a>
<a href="#L232">232</a>
<a href="#L233">233</a>
<a href="#L234">234</a>
<a href="#L235">235</a>
<a href="#L236">236</a>
<a href="#L237">237</a>
<a href="#L238">238</a>
<a href="#L239">239</a>
<a href="#L240">240</a>
<a href="#L241">241</a>
<a href="#L242">242</a>
<a href="#L243">243</a>
<a href="#L244">244</a>
<a href="#L245">245</a>
<a href="#L246">246</a>
<a href="#L247">247</a>
<a href="#L248">248</a>
<a href="#L249">249</a>
<a href="#L250">250</a>
<a href="#L251">251</a>
<a href="#L252">252</a>
<a href="#L253">253</a>
<a href="#L254">254</a>
<a href="#L255">255</a>
<a href="#L256">256</a>
<a href="#L257">257</a>
<a href="#L258">258</a>
<a href="#L259">259</a>
<a href="#L260">260</a>
<a href="#L261">261</a>
<a href="#L262">262</a>
<a href="#L263">263</a>
<a href="#L264">264</a>
<a href="#L265">265</a>
<a href="#L266">266</a>
<a href="#L267">267</a>
<a href="#L268">268</a>
<a href="#L269">269</a>
<a href="#L270">270</a>
<a href="#L271">271</a>
<a href="#L272">272</a>
<a href="#L273">273</a>
<a href="#L274">274</a>
<a href="#L275">275</a>
<a href="#L276">276</a>
<a href="#L277">277</a>
<a href="#L278">278</a>
<a href="#L279">279</a>
<a href="#L280">280</a>
<a href="#L281">281</a>
<a href="#L282">282</a>
<a href="#L283">283</a>
<a href="#L284">284</a>
<a href="#L285">285</a>
<a href="#L286">286</a>
<a href="#L287">287</a>
<a href="#L288">288</a>
<a href="#L289">289</a>
<a href="#L290">290</a>
<a href="#L291">291</a>
<a href="#L292">292</a>
<a href="#L293">293</a>
<a href="#L294">294</a>
<a href="#L295">295</a>
<a href="#L296">296</a>
<a href="#L297">297</a>
<a href="#L298">298</a>
<a href="#L299">299</a>
<a href="#L300">300</a>
<a href="#L301">301</a>
<a href="#L302">302</a>
<a href="#L303">303</a>
<a href="#L304">304</a>
<a href="#L305">305</a>
<a href="#L306">306</a>
<a href="#L307">307</a>
<a href="#L308">308</a>
<a href="#L309">309</a>
<a href="#L310">310</a>
<a href="#L311">311</a>
<a href="#L312">312</a>
<a href="#L313">313</a>
<a href="#L314">314</a>
<a href="#L315">315</a>
<a href="#L316">316</a>
<a href="#L317">317</a>
<a href="#L318">318</a>
<a href="#L319">319</a>
<a href="#L320">320</a>
<a href="#L321">321</a>
<a href="#L322">322</a>
<a href="#L323">323</a>
<a href="#L324">324</a>
<a href="#L325">325</a>
<a href="#L326">326</a>
<a href="#L327">327</a>
<a href="#L328">328</a>
<a href="#L329">329</a>
<a href="#L330">330</a>
<a href="#L331">331</a>
<a href="#L332">332</a>
<a href="#L333">333</a>
<a href="#L334">334</a>
<a href="#L335">335</a>
<a href="#L336">336</a>
<a href="#L337">337</a>
<a href="#L338">338</a>
<a href="#L339">339</a>
<a href="#L340">340</a>
<a href="#L341">341</a>
<a href="#L342">342</a>
<a href="#L343">343</a>
<a href="#L344">344</a>
<a href="#L345">345</a>
<a href="#L346">346</a>
<a href="#L347">347</a>
<a href="#L348">348</a>
<a href="#L349">349</a>
<a href="#L350">350</a>
<a href="#L351">351</a>
<a href="#L352">352</a>
<a href="#L353">353</a>
<a href="#L354">354</a>
<a href="#L355">355</a>
<a href="#L356">356</a>
<a href="#L357">357</a>
<a href="#L358">358</a>
<a href="#L359">359</a>
<a href="#L360">360</a>
<a href="#L361">361</a>
<a href="#L362">362</a>
<a href="#L363">363</a>
<a href="#L364">364</a>
<a href="#L365">365</a>
<a href="#L366">366</a>
<a href="#L367">367</a>
<a href="#L368">368</a>
<a href="#L369">369</a>
<a href="#L370">370</a>
<a href="#L371">371</a>
<a href="#L372">372</a>
<a href="#L373">373</a>
<a href="#L374">374</a>
<a href="#L375">375</a>
<a href="#L376">376</a>
<a href="#L377">377</a>
<a href="#L378">378</a>
<a href="#L379">379</a>
<a href="#L380">380</a>
<a href="#L381">381</a>
<a href="#L382">382</a>
<a href="#L383">383</a>
<a href="#L384">384</a>
<a href="#L385">385</a>
<a href="#L386">386</a>
<a href="#L387">387</a>
<a href="#L388">388</a>
<a href="#L389">389</a>
<a href="#L390">390</a>
<a href="#L391">391</a>
<a href="#L392">392</a>
<a href="#L393">393</a>
<a href="#L394">394</a>
<a href="#L395">395</a>
<a href="#L396">396</a>
<a href="#L397">397</a>
<a href="#L398">398</a>
<a href="#L399">399</a>
<a href="#L400">400</a>
<a href="#L401">401</a>
<a href="#L402">402</a>
<a href="#L403">403</a>
<a href="#L404">404</a>
<a href="#L405">405</a>
<a href="#L406">406</a>
<a href="#L407">407</a>
<a href="#L408">408</a>
<a href="#L409">409</a>
<a href="#L410">410</a>
<a href="#L411">411</a>
<a href="#L412">412</a>
<a href="#L413">413</a>
<a href="#L414">414</a>
<a href="#L415">415</a>
<a href="#L416">416</a>
<a href="#L417">417</a>
<a href="#L418">418</a>
<a href="#L419">419</a>
<a href="#L420">420</a>
<a href="#L421">421</a>
<a href="#L422">422</a>
<a href="#L423">423</a>
<a href="#L424">424</a>
<a href="#L425">425</a>
<a href="#L426">426</a>
<a href="#L427">427</a>
<a href="#L428">428</a>
<a href="#L429">429</a>
<a href="#L430">430</a>
<a href="#L431">431</a>
<a href="#L432">432</a>
<a href="#L433">433</a>
<a href="#L434">434</a>
<a href="#L435">435</a>
<a href="#L436">436</a>
<a href="#L437">437</a>
<a href="#L438">438</a>
<a href="#L439">439</a>
<a href="#L440">440</a>
<a href="#L441">441</a>
<a href="#L442">442</a>
<a href="#L443">443</a>
<a href="#L444">444</a>
<a href="#L445">445</a>
<a href="#L446">446</a>
<a href="#L447">447</a>
<a href="#L448">448</a>
<a href="#L449">449</a>
<a href="#L450">450</a>
<a href="#L451">451</a>
<a href="#L452">452</a>
<a href="#L453">453</a>
<a href="#L454">454</a>
<a href="#L455">455</a>
<a href="#L456">456</a>
<a href="#L457">457</a>
<a href="#L458">458</a>
<a href="#L459">459</a>
<a href="#L460">460</a>
<a href="#L461">461</a>
<a href="#L462">462</a>
<a href="#L463">463</a>
<a href="#L464">464</a>
<a href="#L465">465</a>
<a href="#L466">466</a>
<a href="#L467">467</a>
<a href="#L468">468</a>
<a href="#L469">469</a>
<a href="#L470">470</a>
<a href="#L471">471</a>
<a href="#L472">472</a>
<a href="#L473">473</a>
<a href="#L474">474</a>
<a href="#L475">475</a>
<a href="#L476">476</a>
<a href="#L477">477</a>
<a href="#L478">478</a>
<a href="#L479">479</a>
<a href="#L480">480</a>
<a href="#L481">481</a>
<a href="#L482">482</a>
<a href="#L483">483</a>
<a href="#L484">484</a>
<a href="#L485">485</a>
<a href="#L486">486</a>
<a href="#L487">487</a>
<a href="#L488">488</a>
<a href="#L489">489</a>
<a href="#L490">490</a>
<a href="#L491">491</a>
<a href="#L492">492</a>
<a href="#L493">493</a>
<a href="#L494">494</a>
<a href="#L495">495</a>
<a href="#L496">496</a>
<a href="#L497">497</a>
<a href="#L498">498</a>
<a href="#L499">499</a>
<a href="#L500">500</a>
<a href="#L501">501</a>
<a href="#L502">502</a>
<a href="#L503">503</a>
<a href="#L504">504</a>
<a href="#L505">505</a>
<a href="#L506">506</a>
<a href="#L507">507</a>
<a href="#L508">508</a>
<a href="#L509">509</a>
<a href="#L510">510</a>
<a href="#L511">511</a>
<a href="#L512">512</a>
<a href="#L513">513</a>
<a href="#L514">514</a>
</pre>
<pre><code class="ocaml">(* SPDX-License-Identifier: AGPL-3.0-or-later *)
(* Copyright © 2021-2024 OCamlPro *)
(* Written by the Owi programmers *)

open Bos
open Syntax
module Choice = Concolic.Choice

(* let () = Random.self_init () *)
let () = Random.ini<span data-count="986">t</span> 42

(* TODO: add a flag for this *)
let print_paths = false

let ( let** ) (t : 'a Result.t Choice.t) (f : 'a -&gt; 'b Result.t Choice.t) :
  'b Result.t Choice.t =
  <span data-count="524">C</span>hoice.bind t (fun t -&gt;
    <span data-count="524">m</span>atch t with <span data-count="0">E</span>rror e -&gt; Choice.return (Error e) | <span data-count="524">O</span>k x -&gt; f x )

let simplify_then_link ~entry_point ~invoke_with_symbols ~unsafe ~rac ~srac
  ~optimize link_state m =
  <span data-count="165">l</span>et* m =
    match m with
    | <span data-count="4">K</span>ind.Wat _ | <span data-count="161">W</span>asm _ -&gt;
      Compile.Any.until_binary_validat<span data-count="165">e</span> ~unsafe ~rac ~srac m
    | <span data-count="0">W</span>ast _ -&gt; Fmt.error_ms<span data-count="0">g</span> "can't run concolic interpreter on a script"
    | Ocaml _ -&gt; assert false
  in
  <span data-count="165">l</span>et* m = Cmd_utils.set_entry_poin<span data-count="165">t</span> entry_point invoke_with_symbols m in
  <span data-count="165">l</span>et+ m, link_state =
    Compile.Binary.until_lin<span data-count="165">k</span> ~unsafe ~optimize ~name:None link_state m
  in
  <span data-count="165">l</span>et module_to_run = Concolic.convert_module_to_run m in
  <span data-count="165">(</span>link_state, module_to_run)

let simplify_then_link_files ~entry_point ~invoke_with_symbols ~unsafe ~rac
  ~srac ~optimize filenames =
  <span data-count="165">l</span>et link_state = Link.empty_state in
  let link_state =
    Link.extern_module' link_state ~name:"symbolic"
      ~func_typ:Concolic.Extern_func.extern_type
      Concolic_wasm_ffi.symbolic_extern_module
  in
  <span data-count="165">l</span>et link_state =
    Link.extern_module' link_state ~name:"summaries"
      ~func_typ:Concolic.Extern_func.extern_type
      Concolic_wasm_ffi.summaries_extern_module
  in
  <span data-count="165">l</span>et+ link_state, modules_to_run =
    List.fold_lef<span data-count="165">t</span>
      (fun (acc : (_ * _) Result.t) filename -&gt;
        <span data-count="165">l</span>et* link_state, modules_to_run = acc in
        <span data-count="165">l</span>et* m0dule = Parse.guess_from_fil<span data-count="165">e</span> filename in
        <span data-count="165">l</span>et+ link_state, module_to_run =
          simplify_then_lin<span data-count="165">k</span> ~entry_point ~invoke_with_symbols ~unsafe ~rac
            ~srac ~optimize link_state m0dule
        in
        <span data-count="165">(</span>link_state, module_to_run :: modules_to_run) )
      (Ok (link_state, []))
      filenames
  in
  <span data-count="165">(</span>link_state, List.re<span data-count="165">v</span> modules_to_run)

let run_modules_to_run (link_state : _ Link.state) modules_to_run =
  <span data-count="524">L</span>ist.fold_left
    (fun (acc : unit Result.t Concolic.Choice.t) to_run -&gt;
      <span data-count="524">l</span>et** () = acc in
      <span data-count="524">(</span>Interpret.Concolic.modu<span data-count="524">l</span> link_state.envs) to_run )
    (Choice.retur<span data-count="524">n</span> (Ok ())) modules_to_run

type end_of_trace =
  | Assume_fail
  | Assert_fail
  | Trap of Trap.t
  | Normal

type trace =
  { assignments : Concolic_choice.assignments
  ; remaining_pc : Concolic_choice.pc_elt list
  ; end_of_trace : end_of_trace
  }

module IMap = Map.Make (Prelude.Int32)

module Unexplored : sig
  type t

  val none : t -&gt; bool

  val zero : t

  val one : t

  val add : t -&gt; t -&gt; t
end = struct
  type t = int

  let none t = <span data-count="9811">t</span> = 0

  let zero = 0

  let one = 1

  let add a b = <span data-count="7274">a</span> + b
end

type unexplored = Unexplored.t

type assert_status =
  | Unknown
  | Valid
  | Invalid of Concolic_choice.assignments

type node =
  | Select of
      { cond : Smtml.Expr.t
      ; if_true : eval_tree
      ; if_false : eval_tree
      }
  | Select_i32 of
      { value : Smtml.Expr.t
      ; branches : eval_tree IMap.t
      }
  | Assume of
      { cond : Smtml.Expr.t
      ; cont : eval_tree
      }
  | Assert of
      { cond : Smtml.Expr.t
      ; cont : eval_tree
      ; mutable status : assert_status
      }
  | Unreachable
  | Not_explored  (** A node was discovered but has not yet been explored *)
  | Being_explored
    (** A node that has been seen in `find_node_to_run` and is being explored *)
  | Explored  (** A fully explored path *)

and eval_tree =
  { mutable node : node
  ; mutable unexplored : unexplored
  ; pc : Concolic_choice.pc
  ; mutable ends : (end_of_trace * Concolic_choice.assignments) list
  }

let pp_node fmt = function
  | <span data-count="0">S</span>elect _ -&gt; Fmt.string fmt "Select"
  | <span data-count="0">S</span>elect_i32 _ -&gt; Fmt.string fmt "Select_i32"
  | <span data-count="0">A</span>ssume _ -&gt; Fmt.string fmt "Assume"
  | <span data-count="0">A</span>ssert _ -&gt; Fmt.string fmt "Assert"
  | <span data-count="0">U</span>nreachable -&gt; Fmt.string fmt "Unreachable"
  | <span data-count="0">N</span>ot_explored -&gt; Fmt.string fmt "Not_explored"
  | <span data-count="0">B</span>eing_explored -&gt; Fmt.string fmt "Being_explored"
  | <span data-count="0">E</span>xplored -&gt; Fmt.string fmt "Explored"

let _ = pp_node

let count_unexplored (tree : eval_tree) : Unexplored.t =
  <span data-count="14787">m</span>atch tree.node with
  | <span data-count="7049">S</span>elect { if_true; if_false; _ } -&gt;
    Unexplored.add if_true.unexplored if_false.unexplored
  | <span data-count="295">S</span>elect_i32 { branches; _ } -&gt;
    IMap.fold
      (fun _ branch -&gt; <span data-count="225">U</span>nexplored.add branch.unexplored)
      branches Unexplored.zero
  | <span data-count="5839">A</span>ssume { cont; _ } | <span data-count="463">A</span>ssert { cont; _ } -&gt; cont.unexplored
  | <span data-count="405">U</span>nreachable | <span data-count="283">B</span>eing_explored | <span data-count="299">E</span>xplored -&gt; Unexplored.zero
  | <span data-count="154">N</span>ot_explored -&gt; Unexplored.one

let update_unexplored tree = <span data-count="14787">t</span>ree.unexplored &lt;- count_unexplore<span data-count="14787">d</span> tree

let update_node (tree : eval_tree) (node : node) : unit =
  <span data-count="1659">t</span>ree.node &lt;- node;
  update_unexplored tree

let fresh_tree (pc : Concolic_choice.pc) : eval_tree =
  <span data-count="2833">{</span> node = Not_explored; unexplored = Unexplored.one; pc; ends = [] }

let new_node (pc : Concolic_choice.pc) (head : Concolic_choice.pc_elt) : node =
  <span data-count="1589">m</span>atch head with
  | <span data-count="1079">S</span>elect (_, cond) -&gt;
    Select
      { cond
      ; if_true = fresh_tre<span data-count="1079">e</span> (Select (true, cond) :: pc)
      ; if_false = fresh_tre<span data-count="1079">e</span> (Select (false, cond) :: pc)
      }
  | <span data-count="70">S</span>elect_i32 (_, value) -&gt; Select_i32 { value; branches = IMap.empty }
  | <span data-count="283">A</span>ssume cond -&gt; Assume { cond; cont = fresh_tre<span data-count="283">e</span> (Assume cond :: pc) }
  | <span data-count="157">A</span>ssert cond -&gt;
    Assert { cond; cont = fresh_tre<span data-count="157">e</span> (Assert cond :: pc); status = Unknown }
  | <span data-count="0">E</span>ltExplicitStop -&gt; Explored

let try_initialize (pc : Concolic_choice.pc) (node : eval_tree)
  (head : Concolic_choice.pc_elt) =
  <span data-count="4204">m</span>atch node.node with
  | <span data-count="1449">N</span>ot_explored | <span data-count="140">B</span>eing_explored -&gt; update_node node (new_nod<span data-count="1589">e</span> pc head)
  | <span data-count="2615">_</span> -&gt; ()

let check = true

let set_on_unexplored tree transition =
  <span data-count="301">m</span>atch tree.node with
  | <span data-count="290">N</span>ot_explored | <span data-count="11">B</span>eing_explored -&gt; tree.node &lt;- transition
  | _ -&gt; assert false (* Sanity Check *)

let rec add_trace (pc : Concolic_choice.pc) (node : eval_tree) (trace : trace)
  (to_update : eval_tree list) : eval_tree list =
  <span data-count="4728">m</span>atch trace.remaining_pc with
  | <span data-count="524">[</span>] -&gt; begin
    node.ends &lt;- (trace.end_of_trace, trace.assignments) :: node.ends;
    ( match trace.end_of_trace with
    | <span data-count="299">N</span>ormal -&gt; set_on_unexplore<span data-count="299">d</span> node Explored
    | <span data-count="219">A</span>ssume_fail -&gt;
      (* TODO: do something in this case? Otherwise, it might remain in Being_explored in unsat paths? *)
      ()
    | <span data-count="2">T</span>rap Unreachable -&gt; set_on_unexplore<span data-count="2">d</span> node Unreachable
    | <span data-count="0">T</span>rap _ | <span data-count="4">A</span>ssert_fail -&gt;
      (* TODO: Mark this as explored to avoid possibly empty pcs? *)
      () );
    node :: to_update
  end
  | <span data-count="4204">h</span>ead_of_trace :: tail_of_trace -&gt; (
    try_initialize pc node head_of_trace;
    <span data-count="4204">l</span>et pc = head_of_trace :: pc in
    match (node.node, head_of_trace) with
    | Assert _, EltExplicitStop -&gt; assert false
    | (Unreachable | Not_explored | Being_explored | Explored), _ -&gt;
      assert false
    | <span data-count="2184">S</span>elect { cond; if_true; if_false }, Select (v, cond') -&gt;
      if check then assert <span data-count="4368">(</span>Smtml.Expr.equa<span data-count="2184">l</span> cond cond');
      <span data-count="2184">l</span>et branch = if v then <span data-count="1022">i</span>f_true else <span data-count="1162">i</span>f_false in
      add_trace pc branch
        { trace with remaining_pc = tail_of_trace }
        (node :: to_update)
    | _, Select _ | Select _, _ -&gt; assert false
    | <span data-count="85">S</span>elect_i32 { value; branches }, Select_i32 (v, value') -&gt;
      if check then assert <span data-count="170">(</span>Smtml.Expr.equa<span data-count="85">l</span> value value');
      <span data-count="85">l</span>et branch =
        match IMap.find_opt v branches with
        | <span data-count="70">N</span>one -&gt;
          let t = fresh_tree pc in
          <span data-count="70">u</span>pdate_node node
            (Select_i32 { value; branches = IMap.ad<span data-count="70">d</span> v t branches });
          <span data-count="70">t</span>
        | <span data-count="15">S</span>ome t -&gt; t
      in
      add_trace pc branch
        { trace with remaining_pc = tail_of_trace }
        (node :: to_update)
    | _, Select_i32 _ | Select_i32 _, _ -&gt; assert false
    | <span data-count="1730">A</span>ssume { cond; cont }, Assume cond' -&gt;
      if check then assert <span data-count="3460">(</span>Smtml.Expr.equa<span data-count="1730">l</span> cond cond');
      <span data-count="1730">a</span>dd_trace pc cont
        { trace with remaining_pc = tail_of_trace }
        (node :: to_update)
    | _, Assume _ | Assume _, _ -&gt; assert false
    | <span data-count="205">A</span>ssert ({ cond; cont; status = _ } as assert_), Assert cond' -&gt;
      if check then assert <span data-count="410">(</span>Smtml.Expr.equa<span data-count="205">l</span> cond cond');
      <span data-count="205">(</span> match (tail_of_trace, trace.end_of_trace) with
      | <span data-count="1">[</span>], Assert_fail -&gt; assert_.status &lt;- Invalid trace.assignments
      | <span data-count="204">_</span> -&gt; () );
      add_trace pc cont
        { trace with remaining_pc = tail_of_trace }
        (node :: to_update) )

let add_trace tree trace =
  <span data-count="524">l</span>et to_update = add_trace [] tree trace [] in
  <span data-count="524">L</span>ist.iter update_unexplored to_update

let run_once link_state modules_to_run (forced_values : Smtml.Model.t) =
  <span data-count="524">l</span>et backups = List.map Concolic.backup modules_to_run in
  <span data-count="524">l</span>et result = run_modules_to_run link_state modules_to_run in
  <span data-count="524">l</span>et ( result
      , Concolic_choice.
          { pc
          ; symbols = _
          ; symbols_value
          ; shared = _
          ; preallocated_values = _
          } ) =
    Concolic_choice.run forced_values result
  in
  <span data-count="524">l</span>et () = List.iter2 Concolic.recover backups modules_to_run in
  <span data-count="524">l</span>et+ end_of_trace =
    match result with
    | <span data-count="299">O</span>k (Ok ()) -&gt; Ok Normal
    | <span data-count="0">O</span>k (Error _ as e) -&gt; e
    | <span data-count="2">E</span>rror (Trap t) -&gt; Ok (Trap t)
    | <span data-count="4">E</span>rror Assert_fail -&gt; Ok Assert_fail
    | <span data-count="219">E</span>rror (Assume_fail _c) -&gt; Ok Assume_fail
    | <span data-count="0">E</span>rror ErrExplicitStop -&gt; Ok Normal
  in
  <span data-count="524">l</span>et trace =
    { assignments = symbols_value; remaining_pc = List.re<span data-count="524">v</span> pc; end_of_trace }
  in
  (result, trace)

(* Very naive ! *)
let find_node_to_run tree =
  <span data-count="939">l</span>et ( let* ) = Option.bind in
  let rec loop tree to_update =
    <span data-count="12280">m</span>atch tree.node with
    | <span data-count="619">N</span>ot_explored -&gt;
      Log.debug2 "Try unexplored@.%a@." Concolic_choice.pp_pc tree.pc;
      <span data-count="619">S</span>ome (tree.pc, tree :: to_update)
    | <span data-count="4865">S</span>elect { cond = _; if_true; if_false } -&gt;
      let* b =
        match
          ( Unexplored.non<span data-count="4865">e</span> if_true.unexplored
          , Unexplored.non<span data-count="4865">e</span> if_false.unexplored )
        with
        | <span data-count="1091">t</span>rue, false -&gt; Some false (* Unexplored paths in `else` branch *)
        | <span data-count="1870">f</span>alse, true -&gt; Some true (* Unexplored paths in `then` branch *)
        | <span data-count="1856">f</span>alse, false -&gt; Some (Random.boo<span data-count="1856">l</span> ()) (* Unexplored in both *)
        | <span data-count="48">t</span>rue, true -&gt; None (* No unexplored remain *)
      in
      <span data-count="4817">L</span>og.debug1 "Select bool %b@." b;
      <span data-count="4817">l</span>oop (if b then <span data-count="2735">i</span>f_true else <span data-count="2082">i</span>f_false) (tree :: to_update)
    | <span data-count="81">S</span>elect_i32 { value = _; branches } -&gt;
      (* TODO: better ! *)
      let branches = IMap.bindings branches in
      <span data-count="81">l</span>et branches =
        List.filter (fun (_i, v) -&gt; <span data-count="81">n</span>ot (Unexplored.non<span data-count="81">e</span> v.unexplored)) branches
      in
      <span data-count="81">l</span>et n = List.length branches in
      <span data-count="81">i</span>f n = 0 then <span data-count="0">N</span>one
      else <span data-count="81">b</span>egin
        let i = Random.int n in
        (* TODO: change the datastructure or stop being random ? *)
        <span data-count="81">m</span>atch List.nth_opt branches i with
        | None -&gt; assert false
        | <span data-count="81">S</span>ome (i, branch) -&gt;
          Log.debug1 "Select_i32 %li@." i;
          <span data-count="81">l</span>oop branch (tree :: to_update)
      end
    | <span data-count="6358">A</span>ssume { cond = _; cont } -&gt; loop cont (tree :: to_update)
    | <span data-count="24">A</span>ssert { cond; cont = _; status = Unknown } -&gt;
      let pc : Concolic_choice.pc = Select (false, cond) :: tree.pc in
      Log.debug2 "Try Assert@.%a@.@." Concolic_choice.pp_pc pc;
      <span data-count="24">S</span>ome (pc, tree :: to_update)
    | <span data-count="85">A</span>ssert { cond = _; cont; status = _ } -&gt; loop cont (tree :: to_update)
    | <span data-count="160">U</span>nreachable -&gt;
      Log.debug2 "Unreachable (Retry)@.%a@." Concolic_choice.pp_pc tree.pc;
      <span data-count="160">N</span>one
    | <span data-count="0">B</span>eing_explored | <span data-count="88">E</span>xplored -&gt; None
  in
  loop tree []

let pc_model solver pc =
  <span data-count="862">l</span>et pc = Concolic_choice.pc_to_exprs pc in
  <span data-count="862">m</span>atch Solver.check solver pc with
  | <span data-count="503">`</span>Unsat | <span data-count="0">`</span>Unknown -&gt; None
  | <span data-count="359">`</span>Sat -&gt;
    let symbols = Some (Smtml.Expr.get_symbol<span data-count="359">s</span> pc) in
    Some (Solver.mode<span data-count="359">l</span> ~symbols ~pc solver)

let rec find_model_to_run solver tree =
  <span data-count="939">l</span>et ( let* ) = Option.bind in
  let* pc, to_update = find_node_to_ru<span data-count="939">n</span> tree in
  <span data-count="643">l</span>et node = match to_update with [] -&gt; assert false | <span data-count="643">h</span>d :: _tl -&gt; hd in
  let model =
    match pc with
    | [] -&gt; assert false
    | <span data-count="643">p</span>c -&gt; (
      match pc_model solver pc with
      | <span data-count="425">N</span>one -&gt;
        ( match node.node with
        | <span data-count="403">N</span>ot_explored -&gt; node.node &lt;- Unreachable
        | <span data-count="22">A</span>ssert assert_ -&gt; assert_.status &lt;- Valid
        | _ -&gt; assert false (* Sanity check *) );
        find_model_to_ru<span data-count="425">n</span> solver tree
      | <span data-count="218">S</span>ome model -&gt;
        ( match node.node with
        | <span data-count="216">N</span>ot_explored -&gt; node.node &lt;- Being_explored
        | <span data-count="2">A</span>ssert assert_ -&gt; assert_.status &lt;- Invalid [] (* TODO: assignments *)
        | _ -&gt; assert false (* Sanity check *) );
        Some model )
  in
  (* Have to update tree because of the paths trimmed above *)
  List.iter update_unexplored to_update;
  <span data-count="643">m</span>odel

let count_path = ref 0

let run solver tree link_state modules_to_run =
  (* Initial model is empty (no symbolic variables yet) *)
  <span data-count="165">l</span>et initial_model = Hashtbl.create 0 in
  <span data-count="165">l</span>et rec loop model =
    <span data-count="524">i</span>ncr count_path;
    <span data-count="524">l</span>et* result, trace = run_onc<span data-count="524">e</span> link_state modules_to_run model in
    <span data-count="524">a</span>dd_trace tree trace;
    <span data-count="524">l</span>et* error =
      match result with
      | <span data-count="299">O</span>k (Ok ()) -&gt; Ok None
      | <span data-count="0">O</span>k (Error _ as e) -&gt; e
      | <span data-count="219">E</span>rror (Assume_fail c) -&gt; (
        decr count_path;
        (* Current path condition led to assume failure, try to satisfy *)
        <span data-count="219">L</span>og.debug2 "Assume_fail: %a@." Smtml.Expr.pp c;
        <span data-count="219">L</span>og.debug2 "Pc:@.%a" Concolic_choice.pp_pc trace.remaining_pc;
        <span data-count="219">L</span>og.debug2 "Assignments:@.%a@."
          (Concolic_choice.pp_assignments ~no_value:false)
          trace.assignments;
        <span data-count="219">L</span>og.debug0 "Retry !@.";
        <span data-count="219">m</span>atch pc_model solver (Assume c :: trace.remaining_pc) with
        | <span data-count="141">S</span>ome model -&gt; loo<span data-count="141">p</span> model
        | <span data-count="78">N</span>one -&gt; Ok None )
      | <span data-count="2">E</span>rror (Trap trap) -&gt;
        (* TODO: Check if we want to report this *)
        Ok (Some (`Trap trap, trace))
      | <span data-count="4">E</span>rror Assert_fail -&gt;
        (* TODO: Check if we want to report this *)
        Ok (Some (`Assert_fail, trace))
      | <span data-count="0">E</span>rror ErrExplicitStop -&gt; Ok None
    in
    <span data-count="524">m</span>atch error with
    | <span data-count="10">S</span>ome _ -&gt; Ok error
    | <span data-count="514">N</span>one -&gt; (
      (* No error, we can go again if we still have stuff to explore *)
      match find_model_to_run solver tree with
      | <span data-count="296">N</span>one -&gt; Ok None
      | <span data-count="218">S</span>ome model -&gt; loop model )
  in
  loop initial_model

let assignments_to_model (assignments : (Smtml.Symbol.t * V.t) list) :
  Smtml.Model.t =
  <span data-count="6">l</span>et table = Hashtbl.create (List.lengt<span data-count="6">h</span> assignments) in
  <span data-count="6">L</span>ist.iter
    (fun (s, v) -&gt;
      <span data-count="14">l</span>et value =
        match v with
        | <span data-count="14">C</span>oncrete_value.I32 x -&gt; Smtml.Value.Num (I32 x)
        | <span data-count="0">I</span>64 x -&gt; Num (I64 x)
        | <span data-count="0">F</span>32 x -&gt; Num (F32 (Float32.to_bit<span data-count="0">s</span> x))
        | <span data-count="0">F</span>64 x -&gt; Num (F64 (Float64.to_bit<span data-count="0">s</span> x))
        | Ref _ -&gt; assert false
      in
      Hashtbl.add table s value )
    assignments;
  <span data-count="6">t</span>able

(* NB: This function propagates potential errors (Result.err) occurring
   during evaluation (OS, syntax error, etc.), except for Trap and Assert,
   which are handled here. Most of the computations are done in the Result
   monad, hence the let*. *)
let cmd ~profiling ~debug ~unsafe ~rac ~srac ~optimize ~workers:_
  ~no_stop_at_failure:_ ~no_value ~no_assert_failure_expression_printing
  ~deterministic_result_order:_ ~fail_mode:_ ~workspace ~solver ~files ~profile
  ~model_format ~entry_point ~invoke_with_symbols =
  <span data-count="165">l</span>et* workspace =
    match workspace with
    | <span data-count="160">S</span>ome path -&gt; Ok path
    | <span data-count="5">N</span>one -&gt; OS.Dir.tm<span data-count="5">p</span> "owi_conc_%s"
  in
  <span data-count="165">l</span>et* _did_create : bool = OS.Dir.creat<span data-count="165">e</span> Fpath.(workspace / "test-suite") in

  <span data-count="165">O</span>ption.iter Stats.init_logger_to_file profile;
  <span data-count="165">i</span>f profiling then <span data-count="0">L</span>og.profiling_on := true;
  <span data-count="165">i</span>f debug then <span data-count="0">L</span>og.debug_on := true;
  (* deterministic_result_order implies no_stop_at_failure *)
  (* let no_stop_at_failure = deterministic_result_order || no_stop_at_failure in *)
  <span data-count="165">l</span>et to_string m =
    <span data-count="6">l</span>et model = assignments_to_model m in
    <span data-count="6">m</span>atch model_format with
    | <span data-count="0">C</span>md_utils.Json -&gt; Smtml.Model.to_json_string model
    | <span data-count="6">S</span>cfg -&gt; Smtml.Model.to_scfg_string ~no_value model
  in
  let solver = Solver.fresh solver () in
  <span data-count="165">l</span>et* link_state, modules_to_run =
    simplify_then_link_file<span data-count="165">s</span> ~entry_point ~invoke_with_symbols ~unsafe ~rac
      ~srac ~optimize files
  in
  <span data-count="165">l</span>et tree = fresh_tree [] in
  <span data-count="165">l</span>et* result = ru<span data-count="165">n</span> solver tree link_state modules_to_run in
  <span data-count="165">l</span>et testcase assignments =
    <span data-count="6">i</span>f not no_value then
      <span data-count="5">l</span>et testcase : Smtml.Value.t list =
        List.ma<span data-count="5">p</span>
          (fun (_, v) -&gt;
            <span data-count="8">m</span>atch v with
            | <span data-count="8">C</span>oncrete_value.I32 x -&gt; Smtml.Value.Num (I32 x)
            | <span data-count="0">I</span>64 x -&gt; Num (I64 x)
            | <span data-count="0">F</span>32 x -&gt; Num (F32 (Float32.to_bit<span data-count="0">s</span> x))
            | <span data-count="0">F</span>64 x -&gt; Num (F64 (Float64.to_bit<span data-count="0">s</span> x))
            | Ref _ -&gt; assert false )
          assignments
      in
      Cmd_utils.write_testcase ~dir:Fpath.(workspace / "test-suite") testcase
    else <span data-count="1">O</span>k ()
  in
  if print_paths then <span data-count="0">F</span>mt.p<span data-count="0">r</span> "Completed paths: %d@." !count_path;
  <span data-count="165">m</span>atch result with
  | <span data-count="159">N</span>one -&gt;
    Fmt.pr "All OK@.";
    <span data-count="159">O</span>k ()
  | <span data-count="2">S</span>ome (`Trap trap, { assignments; _ }) -&gt;
    let assignments = List.rev assignments in
    <span data-count="2">F</span>mt.pr "Trap: %s@\n" (Trap.to_strin<span data-count="2">g</span> trap);
    <span data-count="2">F</span>mt.pr "Model:@\n @[&lt;v&gt;%s@]@." (to_strin<span data-count="2">g</span> assignments);
    <span data-count="2">l</span>et* () = testcas<span data-count="2">e</span> assignments in
    <span data-count="2">E</span>rror (`Found_bug 1)
  | <span data-count="4">S</span>ome (`Assert_fail, { assignments; _ }) -&gt;
    let assignments = List.rev assignments in
    <span data-count="4">i</span>f no_assert_failure_expression_printing then begin
      <span data-count="0">F</span>mt.p<span data-count="0">r</span> "Assert failure@\n"
    end
    else begin
      (* TODO: print the assert failure expression ! *)
      <span data-count="4">F</span>mt.p<span data-count="4">r</span> "Assert failure@\n"
    end;
    Fmt.pr "Model:@\n @[&lt;v&gt;%s@]@." (to_strin<span data-count="4">g</span> assignments);
    <span data-count="4">l</span>et* () = testcas<span data-count="4">e</span> assignments in
    <span data-count="4">E</span>rror (`Found_bug 1)
</code></pre>
      </div>
    </div>
    <script src="../../coverage.js"></script>
  </body>
</html>
