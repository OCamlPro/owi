<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="utf-8"/>
    <title>concolic_wasm_ffi.ml &mdash; Coverage report</title>
    <meta name="description" content="41.45% coverage in src/concolic/concolic_wasm_ffi.ml">
    <link rel="stylesheet" href="../../coverage.css"/>
    <script src="../../highlight.pack.js"></script>
    <script>hljs.initHighlightingOnLoad();</script>
  </head>
  <body>
    <div id="header">
      <h1>
        <a href="../../index.html">
          <span class="dirname">src/concolic/</span>concolic_wasm_ffi.ml
        </a>
      </h1>
      <h2>41.45%</h2>
    </div>
    <div id="navbar">
      <span class="unvisited" style="top:8.55%"></span>
      <span class="unvisited" style="top:8.97%"></span>
      <span class="unvisited" style="top:9.83%"></span>
      <span class="unvisited" style="top:10.26%"></span>
      <span class="unvisited" style="top:10.68%"></span>
      <span class="unvisited" style="top:12.39%"></span>
      <span class="unvisited" style="top:13.68%"></span>
      <span class="unvisited" style="top:14.53%"></span>
      <span class="unvisited" style="top:15.38%"></span>
      <span class="unvisited" style="top:15.81%"></span>
      <span class="unvisited" style="top:16.24%"></span>
      <span class="unvisited" style="top:17.95%"></span>
      <span class="unvisited" style="top:20.94%"></span>
      <span class="unvisited" style="top:24.79%"></span>
      <span class="unvisited" style="top:25.21%"></span>
      <span class="unvisited" style="top:26.07%"></span>
      <span class="unvisited" style="top:26.50%"></span>
      <span class="unvisited" style="top:28.21%"></span>
      <span class="unvisited" style="top:29.06%"></span>
      <span class="unvisited" style="top:34.62%"></span>
      <span class="unvisited" style="top:35.04%"></span>
      <span class="unvisited" style="top:35.90%"></span>
      <span class="unvisited" style="top:36.32%"></span>
      <span class="unvisited" style="top:37.61%"></span>
      <span class="unvisited" style="top:38.89%"></span>
      <span class="unvisited" style="top:39.32%"></span>
      <span class="unvisited" style="top:40.17%"></span>
      <span class="unvisited" style="top:40.60%"></span>
      <span class="unvisited" style="top:42.31%"></span>
      <span class="unvisited" style="top:43.59%"></span>
      <span class="unvisited" style="top:44.02%"></span>
      <span class="unvisited" style="top:44.87%"></span>
      <span class="unvisited" style="top:45.30%"></span>
      <span class="unvisited" style="top:47.01%"></span>
      <span class="unvisited" style="top:48.29%"></span>
      <span class="unvisited" style="top:48.72%"></span>
      <span class="unvisited" style="top:49.57%"></span>
      <span class="unvisited" style="bottom:49.57%"></span>
      <span class="unvisited" style="bottom:49.15%"></span>
      <span class="unvisited" style="bottom:48.72%"></span>
      <span class="unvisited" style="bottom:47.86%"></span>
      <span class="unvisited" style="bottom:47.44%"></span>
      <span class="unvisited" style="bottom:45.73%"></span>
      <span class="unvisited" style="bottom:36.32%"></span>
      <span class="unvisited" style="bottom:32.48%"></span>
      <span class="unvisited" style="bottom:31.62%"></span>
      <span class="unvisited" style="bottom:31.20%"></span>
      <span class="unvisited" style="bottom:27.78%"></span>
      <span class="unvisited" style="bottom:26.92%"></span>
      <span class="unvisited" style="bottom:26.50%"></span>
      <span class="unvisited" style="bottom:25.64%"></span>
      <span class="unvisited" style="bottom:19.66%"></span>
      <span class="unvisited" style="bottom:18.38%"></span>
      <span class="unvisited" style="bottom:17.95%"></span>
      <span class="unvisited" style="bottom:16.67%"></span>
      <span class="unvisited" style="bottom:16.24%"></span>
      <span class="unvisited" style="bottom:14.96%"></span>
      <span class="unvisited" style="bottom:14.53%"></span>
      <span class="unvisited" style="bottom:13.68%"></span>
      <span class="unvisited" style="bottom:12.82%"></span>
    </div>
    <div id="report">
      <div id="lines-layer">
        <pre>
<a id="L1"></a><span > </span>
<a id="L2"></a><span > </span>
<a id="L3"></a><span > </span>
<a id="L4"></a><span > </span>
<a id="L5"></a><span > </span>
<a id="L6"></a><span > </span>
<a id="L7"></a><span > </span>
<a id="L8"></a><span > </span>
<a id="L9"></a><span > </span>
<a id="L10"></a><span > </span>
<a id="L11"></a><span > </span>
<a id="L12"></a><span > </span>
<a id="L13"></a><span > </span>
<a id="L14"></a><span > </span>
<a id="L15"></a><span > </span>
<a id="L16"></a><span > </span>
<a id="L17"></a><span > </span>
<a id="L18"></a><span > </span>
<a id="L19"></a><span > </span>
<a id="L20"></a><span class="unvisited"> </span>
<a id="L21"></a><span class="unvisited"> </span>
<a id="L22"></a><span > </span>
<a id="L23"></a><span class="unvisited"> </span>
<a id="L24"></a><span class="unvisited"> </span>
<a id="L25"></a><span class="unvisited"> </span>
<a id="L26"></a><span > </span>
<a id="L27"></a><span > </span>
<a id="L28"></a><span > </span>
<a id="L29"></a><span class="unvisited"> </span>
<a id="L30"></a><span > </span>
<a id="L31"></a><span > </span>
<a id="L32"></a><span class="unvisited"> </span>
<a id="L33"></a><span > </span>
<a id="L34"></a><span class="unvisited"> </span>
<a id="L35"></a><span > </span>
<a id="L36"></a><span class="unvisited"> </span>
<a id="L37"></a><span class="unvisited"> </span>
<a id="L38"></a><span class="unvisited"> </span>
<a id="L39"></a><span > </span>
<a id="L40"></a><span > </span>
<a id="L41"></a><span > </span>
<a id="L42"></a><span class="unvisited"> </span>
<a id="L43"></a><span > </span>
<a id="L44"></a><span > </span>
<a id="L45"></a><span class="visited"> </span>
<a id="L46"></a><span class="visited"> </span>
<a id="L47"></a><span > </span>
<a id="L48"></a><span class="visited"> </span>
<a id="L49"></a><span class="unvisited"> </span>
<a id="L50"></a><span > </span>
<a id="L51"></a><span > </span>
<a id="L52"></a><span > </span>
<a id="L53"></a><span class="visited"> </span>
<a id="L54"></a><span > </span>
<a id="L55"></a><span class="visited"> </span>
<a id="L56"></a><span > </span>
<a id="L57"></a><span > </span>
<a id="L58"></a><span class="unvisited"> </span>
<a id="L59"></a><span class="unvisited"> </span>
<a id="L60"></a><span > </span>
<a id="L61"></a><span class="unvisited"> </span>
<a id="L62"></a><span class="unvisited"> </span>
<a id="L63"></a><span > </span>
<a id="L64"></a><span > </span>
<a id="L65"></a><span > </span>
<a id="L66"></a><span class="unvisited"> </span>
<a id="L67"></a><span > </span>
<a id="L68"></a><span class="unvisited"> </span>
<a id="L69"></a><span > </span>
<a id="L70"></a><span > </span>
<a id="L71"></a><span class="visited"> </span>
<a id="L72"></a><span class="visited"> </span>
<a id="L73"></a><span > </span>
<a id="L74"></a><span class="visited"> </span>
<a id="L75"></a><span class="visited"> </span>
<a id="L76"></a><span > </span>
<a id="L77"></a><span > </span>
<a id="L78"></a><span class="visited"> </span>
<a id="L79"></a><span > </span>
<a id="L80"></a><span > </span>
<a id="L81"></a><span class="unvisited"> </span>
<a id="L82"></a><span class="unvisited"> </span>
<a id="L83"></a><span > </span>
<a id="L84"></a><span class="unvisited"> </span>
<a id="L85"></a><span class="unvisited"> </span>
<a id="L86"></a><span > </span>
<a id="L87"></a><span > </span>
<a id="L88"></a><span class="unvisited"> </span>
<a id="L89"></a><span > </span>
<a id="L90"></a><span > </span>
<a id="L91"></a><span class="unvisited"> </span>
<a id="L92"></a><span class="unvisited"> </span>
<a id="L93"></a><span > </span>
<a id="L94"></a><span class="unvisited"> </span>
<a id="L95"></a><span class="unvisited"> </span>
<a id="L96"></a><span > </span>
<a id="L97"></a><span > </span>
<a id="L98"></a><span > </span>
<a id="L99"></a><span class="unvisited"> </span>
<a id="L100"></a><span > </span>
<a id="L101"></a><span > </span>
<a id="L102"></a><span class="unvisited"> </span>
<a id="L103"></a><span class="unvisited"> </span>
<a id="L104"></a><span > </span>
<a id="L105"></a><span class="unvisited"> </span>
<a id="L106"></a><span class="unvisited"> </span>
<a id="L107"></a><span > </span>
<a id="L108"></a><span > </span>
<a id="L109"></a><span > </span>
<a id="L110"></a><span class="unvisited"> </span>
<a id="L111"></a><span > </span>
<a id="L112"></a><span > </span>
<a id="L113"></a><span class="unvisited"> </span>
<a id="L114"></a><span class="unvisited"> </span>
<a id="L115"></a><span > </span>
<a id="L116"></a><span class="unvisited"> </span>
<a id="L117"></a><span > </span>
<a id="L118"></a><span class="unvisited"> </span>
<a id="L119"></a><span class="unvisited"> </span>
<a id="L120"></a><span class="unvisited"> </span>
<a id="L121"></a><span > </span>
<a id="L122"></a><span class="unvisited"> </span>
<a id="L123"></a><span class="unvisited"> </span>
<a id="L124"></a><span > </span>
<a id="L125"></a><span > </span>
<a id="L126"></a><span > </span>
<a id="L127"></a><span class="unvisited"> </span>
<a id="L128"></a><span > </span>
<a id="L129"></a><span class="visited"> </span>
<a id="L130"></a><span > </span>
<a id="L131"></a><span > </span>
<a id="L132"></a><span class="visited"> </span>
<a id="L133"></a><span class="visited"> </span>
<a id="L134"></a><span > </span>
<a id="L135"></a><span > </span>
<a id="L136"></a><span class="visited"> </span>
<a id="L137"></a><span class="visited"> </span>
<a id="L138"></a><span > </span>
<a id="L139"></a><span > </span>
<a id="L140"></a><span > </span>
<a id="L141"></a><span class="visited"> </span>
<a id="L142"></a><span class="visited"> </span>
<a id="L143"></a><span class="visited"> </span>
<a id="L144"></a><span class="visited"> </span>
<a id="L145"></a><span class="visited"> </span>
<a id="L146"></a><span > </span>
<a id="L147"></a><span > </span>
<a id="L148"></a><span > </span>
<a id="L149"></a><span class="unvisited"> </span>
<a id="L150"></a><span > </span>
<a id="L151"></a><span > </span>
<a id="L152"></a><span > </span>
<a id="L153"></a><span > </span>
<a id="L154"></a><span > </span>
<a id="L155"></a><span > </span>
<a id="L156"></a><span class="visited"> </span>
<a id="L157"></a><span class="visited"> </span>
<a id="L158"></a><span class="unvisited"> </span>
<a id="L159"></a><span > </span>
<a id="L160"></a><span class="unvisited"> </span>
<a id="L161"></a><span class="unvisited"> </span>
<a id="L162"></a><span > </span>
<a id="L163"></a><span > </span>
<a id="L164"></a><span class="visited"> </span>
<a id="L165"></a><span class="visited"> </span>
<a id="L166"></a><span > </span>
<a id="L167"></a><span > </span>
<a id="L168"></a><span class="visited"> </span>
<a id="L169"></a><span class="unvisited"> </span>
<a id="L170"></a><span > </span>
<a id="L171"></a><span class="unvisited"> </span>
<a id="L172"></a><span class="unvisited"> </span>
<a id="L173"></a><span > </span>
<a id="L174"></a><span class="unvisited"> </span>
<a id="L175"></a><span > </span>
<a id="L176"></a><span > </span>
<a id="L177"></a><span > </span>
<a id="L178"></a><span class="visited"> </span>
<a id="L179"></a><span class="visited"> </span>
<a id="L180"></a><span > </span>
<a id="L181"></a><span > </span>
<a id="L182"></a><span > </span>
<a id="L183"></a><span class="visited"> </span>
<a id="L184"></a><span class="visited"> </span>
<a id="L185"></a><span class="visited"> </span>
<a id="L186"></a><span > </span>
<a id="L187"></a><span > </span>
<a id="L188"></a><span class="unvisited"> </span>
<a id="L189"></a><span > </span>
<a id="L190"></a><span > </span>
<a id="L191"></a><span class="unvisited"> </span>
<a id="L192"></a><span class="unvisited"> </span>
<a id="L193"></a><span > </span>
<a id="L194"></a><span > </span>
<a id="L195"></a><span class="unvisited"> </span>
<a id="L196"></a><span class="unvisited"> </span>
<a id="L197"></a><span > </span>
<a id="L198"></a><span > </span>
<a id="L199"></a><span class="unvisited"> </span>
<a id="L200"></a><span class="unvisited"> </span>
<a id="L201"></a><span > </span>
<a id="L202"></a><span class="unvisited"> </span>
<a id="L203"></a><span > </span>
<a id="L204"></a><span class="unvisited"> </span>
<a id="L205"></a><span > </span>
<a id="L206"></a><span > </span>
<a id="L207"></a><span > </span>
<a id="L208"></a><span > </span>
<a id="L209"></a><span > </span>
<a id="L210"></a><span > </span>
<a id="L211"></a><span > </span>
<a id="L212"></a><span > </span>
<a id="L213"></a><span > </span>
<a id="L214"></a><span > </span>
<a id="L215"></a><span class="visited"> </span>
<a id="L216"></a><span class="visited"> </span>
<a id="L217"></a><span class="visited"> </span>
<a id="L218"></a><span class="visited"> </span>
<a id="L219"></a><span class="visited"> </span>
<a id="L220"></a><span class="visited"> </span>
<a id="L221"></a><span class="visited"> </span>
<a id="L222"></a><span class="visited"> </span>
<a id="L223"></a><span class="visited"> </span>
<a id="L224"></a><span class="visited"> </span>
<a id="L225"></a><span class="visited"> </span>
<a id="L226"></a><span class="visited"> </span>
<a id="L227"></a><span class="visited"> </span>
<a id="L228"></a><span class="visited"> </span>
<a id="L229"></a><span class="visited"> </span>
<a id="L230"></a><span class="visited"> </span>
<a id="L231"></a><span class="visited"> </span>
<a id="L232"></a><span > </span>
<a id="L233"></a><span > </span>
<a id="L234"></a><span > </span>
</pre>
      </div>
      <div id="text-layer">
        <pre id="line-numbers">
<a href="#L1">  1</a>
<a href="#L2">  2</a>
<a href="#L3">  3</a>
<a href="#L4">  4</a>
<a href="#L5">  5</a>
<a href="#L6">  6</a>
<a href="#L7">  7</a>
<a href="#L8">  8</a>
<a href="#L9">  9</a>
<a href="#L10"> 10</a>
<a href="#L11"> 11</a>
<a href="#L12"> 12</a>
<a href="#L13"> 13</a>
<a href="#L14"> 14</a>
<a href="#L15"> 15</a>
<a href="#L16"> 16</a>
<a href="#L17"> 17</a>
<a href="#L18"> 18</a>
<a href="#L19"> 19</a>
<a href="#L20"> 20</a>
<a href="#L21"> 21</a>
<a href="#L22"> 22</a>
<a href="#L23"> 23</a>
<a href="#L24"> 24</a>
<a href="#L25"> 25</a>
<a href="#L26"> 26</a>
<a href="#L27"> 27</a>
<a href="#L28"> 28</a>
<a href="#L29"> 29</a>
<a href="#L30"> 30</a>
<a href="#L31"> 31</a>
<a href="#L32"> 32</a>
<a href="#L33"> 33</a>
<a href="#L34"> 34</a>
<a href="#L35"> 35</a>
<a href="#L36"> 36</a>
<a href="#L37"> 37</a>
<a href="#L38"> 38</a>
<a href="#L39"> 39</a>
<a href="#L40"> 40</a>
<a href="#L41"> 41</a>
<a href="#L42"> 42</a>
<a href="#L43"> 43</a>
<a href="#L44"> 44</a>
<a href="#L45"> 45</a>
<a href="#L46"> 46</a>
<a href="#L47"> 47</a>
<a href="#L48"> 48</a>
<a href="#L49"> 49</a>
<a href="#L50"> 50</a>
<a href="#L51"> 51</a>
<a href="#L52"> 52</a>
<a href="#L53"> 53</a>
<a href="#L54"> 54</a>
<a href="#L55"> 55</a>
<a href="#L56"> 56</a>
<a href="#L57"> 57</a>
<a href="#L58"> 58</a>
<a href="#L59"> 59</a>
<a href="#L60"> 60</a>
<a href="#L61"> 61</a>
<a href="#L62"> 62</a>
<a href="#L63"> 63</a>
<a href="#L64"> 64</a>
<a href="#L65"> 65</a>
<a href="#L66"> 66</a>
<a href="#L67"> 67</a>
<a href="#L68"> 68</a>
<a href="#L69"> 69</a>
<a href="#L70"> 70</a>
<a href="#L71"> 71</a>
<a href="#L72"> 72</a>
<a href="#L73"> 73</a>
<a href="#L74"> 74</a>
<a href="#L75"> 75</a>
<a href="#L76"> 76</a>
<a href="#L77"> 77</a>
<a href="#L78"> 78</a>
<a href="#L79"> 79</a>
<a href="#L80"> 80</a>
<a href="#L81"> 81</a>
<a href="#L82"> 82</a>
<a href="#L83"> 83</a>
<a href="#L84"> 84</a>
<a href="#L85"> 85</a>
<a href="#L86"> 86</a>
<a href="#L87"> 87</a>
<a href="#L88"> 88</a>
<a href="#L89"> 89</a>
<a href="#L90"> 90</a>
<a href="#L91"> 91</a>
<a href="#L92"> 92</a>
<a href="#L93"> 93</a>
<a href="#L94"> 94</a>
<a href="#L95"> 95</a>
<a href="#L96"> 96</a>
<a href="#L97"> 97</a>
<a href="#L98"> 98</a>
<a href="#L99"> 99</a>
<a href="#L100">100</a>
<a href="#L101">101</a>
<a href="#L102">102</a>
<a href="#L103">103</a>
<a href="#L104">104</a>
<a href="#L105">105</a>
<a href="#L106">106</a>
<a href="#L107">107</a>
<a href="#L108">108</a>
<a href="#L109">109</a>
<a href="#L110">110</a>
<a href="#L111">111</a>
<a href="#L112">112</a>
<a href="#L113">113</a>
<a href="#L114">114</a>
<a href="#L115">115</a>
<a href="#L116">116</a>
<a href="#L117">117</a>
<a href="#L118">118</a>
<a href="#L119">119</a>
<a href="#L120">120</a>
<a href="#L121">121</a>
<a href="#L122">122</a>
<a href="#L123">123</a>
<a href="#L124">124</a>
<a href="#L125">125</a>
<a href="#L126">126</a>
<a href="#L127">127</a>
<a href="#L128">128</a>
<a href="#L129">129</a>
<a href="#L130">130</a>
<a href="#L131">131</a>
<a href="#L132">132</a>
<a href="#L133">133</a>
<a href="#L134">134</a>
<a href="#L135">135</a>
<a href="#L136">136</a>
<a href="#L137">137</a>
<a href="#L138">138</a>
<a href="#L139">139</a>
<a href="#L140">140</a>
<a href="#L141">141</a>
<a href="#L142">142</a>
<a href="#L143">143</a>
<a href="#L144">144</a>
<a href="#L145">145</a>
<a href="#L146">146</a>
<a href="#L147">147</a>
<a href="#L148">148</a>
<a href="#L149">149</a>
<a href="#L150">150</a>
<a href="#L151">151</a>
<a href="#L152">152</a>
<a href="#L153">153</a>
<a href="#L154">154</a>
<a href="#L155">155</a>
<a href="#L156">156</a>
<a href="#L157">157</a>
<a href="#L158">158</a>
<a href="#L159">159</a>
<a href="#L160">160</a>
<a href="#L161">161</a>
<a href="#L162">162</a>
<a href="#L163">163</a>
<a href="#L164">164</a>
<a href="#L165">165</a>
<a href="#L166">166</a>
<a href="#L167">167</a>
<a href="#L168">168</a>
<a href="#L169">169</a>
<a href="#L170">170</a>
<a href="#L171">171</a>
<a href="#L172">172</a>
<a href="#L173">173</a>
<a href="#L174">174</a>
<a href="#L175">175</a>
<a href="#L176">176</a>
<a href="#L177">177</a>
<a href="#L178">178</a>
<a href="#L179">179</a>
<a href="#L180">180</a>
<a href="#L181">181</a>
<a href="#L182">182</a>
<a href="#L183">183</a>
<a href="#L184">184</a>
<a href="#L185">185</a>
<a href="#L186">186</a>
<a href="#L187">187</a>
<a href="#L188">188</a>
<a href="#L189">189</a>
<a href="#L190">190</a>
<a href="#L191">191</a>
<a href="#L192">192</a>
<a href="#L193">193</a>
<a href="#L194">194</a>
<a href="#L195">195</a>
<a href="#L196">196</a>
<a href="#L197">197</a>
<a href="#L198">198</a>
<a href="#L199">199</a>
<a href="#L200">200</a>
<a href="#L201">201</a>
<a href="#L202">202</a>
<a href="#L203">203</a>
<a href="#L204">204</a>
<a href="#L205">205</a>
<a href="#L206">206</a>
<a href="#L207">207</a>
<a href="#L208">208</a>
<a href="#L209">209</a>
<a href="#L210">210</a>
<a href="#L211">211</a>
<a href="#L212">212</a>
<a href="#L213">213</a>
<a href="#L214">214</a>
<a href="#L215">215</a>
<a href="#L216">216</a>
<a href="#L217">217</a>
<a href="#L218">218</a>
<a href="#L219">219</a>
<a href="#L220">220</a>
<a href="#L221">221</a>
<a href="#L222">222</a>
<a href="#L223">223</a>
<a href="#L224">224</a>
<a href="#L225">225</a>
<a href="#L226">226</a>
<a href="#L227">227</a>
<a href="#L228">228</a>
<a href="#L229">229</a>
<a href="#L230">230</a>
<a href="#L231">231</a>
<a href="#L232">232</a>
<a href="#L233">233</a>
<a href="#L234">234</a>
</pre>
<pre><code class="ocaml">(* SPDX-License-Identifier: AGPL-3.0-or-later *)
(* Copyright Â© 2021-2024 OCamlPro *)
(* Written by the Owi programmers *)

module Expr = Smtml.Expr

(* The constraint is used here to make sure we don't forget to define one of the expected FFI functions, this whole file is further constrained such that if one function of M is unused in the FFI module below, an error will be displayed *)
module M :
  Wasm_ffi_intf.S0
    with type 'a t = 'a Concolic_choice.t
     and type memory = Concolic_memory.t
     and module Value = Concolic_value = struct
  type 'a t = 'a Concolic_choice.t

  type memory = Concolic_memory.t

  module Value = Concolic_value

  let symbol_bool () : Value.int32 Concolic_choice.t =
    <span data-count="0">C</span>oncolic_choice.with_new_symbol Ty_bool (fun sym forced_value -&gt;
      <span data-count="0">l</span>et b =
        match forced_value with
        | <span data-count="0">N</span>one -&gt; Random.boo<span data-count="0">l</span> ()
        | <span data-count="0">S</span>ome True -&gt; true
        | <span data-count="0">S</span>ome False -&gt; false
        | _ -&gt; assert false
      in
      let n = Concrete_value.Bool.int32 b in
      <span data-count="0">(</span>I32 n, Value.Bool.int3<span data-count="0">2</span> (b, Expr.symbo<span data-count="0">l</span> sym)) )

  let symbol_invisible_bool () : Value.int32 Concolic_choice.t =
    <span data-count="0">C</span>oncolic_choice.with_new_invisible_symbol Ty_bool
      (fun sym (forced_value : Smtml.Value.t option) -&gt;
      <span data-count="0">l</span>et b =
        match forced_value with
        | <span data-count="0">N</span>one -&gt; Random.boo<span data-count="0">l</span> ()
        | <span data-count="0">S</span>ome True -&gt; true
        | <span data-count="0">S</span>ome False -&gt; false
        | _ -&gt; assert false
      in
      let n = Concrete_value.Bool.int32 b in
      <span data-count="0">(</span>V.I32 n, Value.Bool.int3<span data-count="0">2</span> (b, Expr.symbo<span data-count="0">l</span> sym)) )

  let symbol_i8 () : Value.int32 Concolic_choice.t =
    <span data-count="6">C</span>oncolic_choice.with_new_symbol (Ty_bitv 32) (fun sym forced_value -&gt;
      <span data-count="6">l</span>et n =
        match forced_value with
        | <span data-count="6">N</span>one -&gt; Int32.logan<span data-count="6">d</span> 0xFFl (Random.bits3<span data-count="6">2</span> ())
        | <span data-count="0">S</span>ome (Bitv bv) -&gt; Smtml.Bitvector.to_int3<span data-count="0">2</span> bv
        | _ -&gt; assert false
      in
      let sym_expr =
        Expr.cvtop (Ty_bitv 32) (Zero_extend 24) (Expr.symbo<span data-count="6">l</span> sym)
      in
      <span data-count="6">(</span>I32 n, (n, sym_expr)) )

  let symbol_i16 () : Value.int32 Concolic_choice.t =
    <span data-count="0">C</span>oncolic_choice.with_new_symbol (Ty_bitv 32) (fun sym forced_value -&gt;
      <span data-count="0">l</span>et n =
        match forced_value with
        | <span data-count="0">N</span>one -&gt; Int32.logan<span data-count="0">d</span> 0xFFFFl (Random.bits3<span data-count="0">2</span> ())
        | <span data-count="0">S</span>ome (Bitv bv) -&gt; Smtml.Bitvector.to_int3<span data-count="0">2</span> bv
        | _ -&gt; assert false
      in
      let sym_expr =
        Expr.cvtop (Ty_bitv 32) (Zero_extend 16) (Expr.symbo<span data-count="0">l</span> sym)
      in
      <span data-count="0">(</span>I32 n, (n, sym_expr)) )

  let symbol_i32 () : Value.int32 Concolic_choice.t =
    <span data-count="3178">C</span>oncolic_choice.with_new_symbol (Ty_bitv 32) (fun sym forced_value -&gt;
      <span data-count="3178">l</span>et n =
        match forced_value with
        | <span data-count="1630">N</span>one -&gt; Random.bits3<span data-count="1630">2</span> ()
        | <span data-count="1548">S</span>ome (Bitv bv) -&gt; Smtml.Bitvector.to_int3<span data-count="1548">2</span> bv
        | _ -&gt; assert false
      in
      (I32 n, (n, Expr.symbo<span data-count="3178">l</span> sym)) )

  let symbol_i64 () : Value.int64 Concolic_choice.t =
    <span data-count="0">C</span>oncolic_choice.with_new_symbol (Ty_bitv 64) (fun sym forced_value -&gt;
      <span data-count="0">l</span>et n =
        match forced_value with
        | <span data-count="0">N</span>one -&gt; Random.bits6<span data-count="0">4</span> ()
        | <span data-count="0">S</span>ome (Bitv bv) -&gt; Smtml.Bitvector.to_int6<span data-count="0">4</span> bv
        | _ -&gt; assert false
      in
      (I64 n, (n, Expr.symbo<span data-count="0">l</span> sym)) )

  let symbol_f32 () : Value.float32 Concolic_choice.t =
    <span data-count="0">C</span>oncolic_choice.with_new_symbol (Ty_fp 32) (fun sym forced_value -&gt;
      <span data-count="0">l</span>et n =
        match forced_value with
        | <span data-count="0">N</span>one -&gt; Random.bits3<span data-count="0">2</span> ()
        | <span data-count="0">S</span>ome (Num (F32 n)) -&gt; n
        | _ -&gt; assert false
      in
      let n = Float32.of_bits n in
      <span data-count="0">(</span>F32 n, (n, Expr.symbo<span data-count="0">l</span> sym)) )

  let symbol_f64 () : Value.float64 Concolic_choice.t =
    <span data-count="0">C</span>oncolic_choice.with_new_symbol (Ty_fp 64) (fun sym forced_value -&gt;
      <span data-count="0">l</span>et n =
        match forced_value with
        | <span data-count="0">N</span>one -&gt; Random.bits6<span data-count="0">4</span> ()
        | <span data-count="0">S</span>ome (Num (F64 n)) -&gt; n
        | _ -&gt; assert false
      in
      let n = Float64.of_bits n in
      <span data-count="0">(</span>F64 n, (n, Expr.symbo<span data-count="0">l</span> sym)) )

  let symbol_v128 () : Value.v128 Concolic_choice.t =
    <span data-count="0">C</span>oncolic_choice.with_new_symbol (Ty_bitv 128) (fun sym forced_value -&gt;
      <span data-count="0">l</span>et a, b =
        match forced_value with
        | <span data-count="0">N</span>one -&gt;
          let a = Random.bits64 () in
          <span data-count="0">l</span>et b = Random.bits64 () in
          <span data-count="0">(</span>a, b)
        | <span data-count="0">S</span>ome (Bitv n) -&gt;
          let a = Smtml.Bitvector.extract n ~low:8 ~high:16 in
          <span data-count="0">l</span>et b = Smtml.Bitvector.extract n ~low:0 ~high:8 in
          <span data-count="0">(</span>Smtml.Bitvector.to_int6<span data-count="0">4</span> a, Smtml.Bitvector.to_int6<span data-count="0">4</span> b)
        | _ -&gt; assert false
      in
      let n = V128.of_i64x2 a b in
      <span data-count="0">(</span>V128 n, (n, Expr.symbo<span data-count="0">l</span> sym)) )

  let add_pc_wrapper e = <span data-count="1950">C</span>oncolic_choice.assume e

  let assume (i : Value.int32) : unit Concolic_choice.t =
    <span data-count="1932">l</span>et c = Value.I32.to_bool i in
    <span data-count="1932">a</span>dd_pc_wrapper c

  let assert' (i : Value.int32) : unit Concolic_choice.t =
    <span data-count="1151">l</span>et c = Value.I32.to_bool i in
    <span data-count="1151">C</span>oncolic_choice.assertion c

  let symbol_range (lo : Value.int32) (hi : Value.int32) :
    Value.int32 Concolic_choice.t =
    <span data-count="10">l</span>et open Concolic_choice in
    let* x = symbol_i3<span data-count="10">2</span> () in
    <span data-count="10">l</span>et* () = add_pc_wrappe<span data-count="10">r</span> (Value.I32.l<span data-count="10">e</span> lo x) in
    <span data-count="8">l</span>et+ () = add_pc_wrappe<span data-count="8">r</span> (Value.I32.g<span data-count="8">t</span> hi x) in
    <span data-count="6">x</span>

  open Expr

  let abort () : unit Concolic_choice.t = <span data-count="0">C</span>oncolic_choice.abort

  let i32 ((_c, s) : Value.int32) : int32 Concolic_choice.t =
    (* TODO: select_i32 ? *)
    (* let+ v = Concolic_choice.select_i32 v in *)
    (* let n = v.c in *)
    (* let x = Concolic_choice.assume (Value.I32.eq v (Value.const_i32 n)) in *)
    <span data-count="3334">m</span>atch view s with
    | <span data-count="3334">V</span>al (Bitv bv) -&gt; Concolic_choice.return (Smtml.Bitvector.to_int3<span data-count="3334">2</span> bv)
    | <span data-count="0">_</span> -&gt;
      Logs.err (fun m -&gt;
        <span data-count="0">m</span> {|alloc: cannot allocate base pointer "%a"|} Expr.pp s );
      <span data-count="0">C</span>oncolic_choice.bind (abor<span data-count="0">t</span> ()) (fun () -&gt; <span data-count="0">a</span>ssert false)

  let ptr ((_c, s) : Value.int32) : int32 Concolic_choice.t =
    <span data-count="1932">m</span>atch view s with
    | <span data-count="1932">P</span>tr { base; _ } -&gt;
      (* TODO: why don't we use offset here ? *)
      let base = Smtml.Bitvector.to_int32 base in
      <span data-count="1932">C</span>oncolic_choice.return base
    | <span data-count="0">_</span> -&gt;
      Logs.err (fun m -&gt;
        <span data-count="0">m</span> {|free: cannot fetch pointer base of "%a"|} Expr.pp s );
      <span data-count="0">C</span>oncolic_choice.bind (abor<span data-count="0">t</span> ()) (fun () -&gt; <span data-count="0">a</span>ssert false)

  let exit (_p : Value.int32) : unit Concolic_choice.t = <span data-count="0">a</span>bort ()

  let alloc _ (base : Value.int32) (_size : Value.int32) :
    Value.int32 Concolic_choice.t =
    <span data-count="3334">C</span>oncolic_choice.bind (i3<span data-count="3334">2</span> base) (fun (base : int32) -&gt;
      <span data-count="3334">C</span>oncolic_choice.return (base, Expr.pt<span data-count="3334">r</span> base (Symbolic_value.const_i3<span data-count="3334">2</span> 0l)) )

  let free _ (p : Value.int32) =
    (* WHAT ???? *)
    <span data-count="1932">l</span>et open Concolic_choice in
    let+ base = pt<span data-count="1932">r</span> p in
    <span data-count="1932">V</span>alue.const_i32 base

  let in_replay_mode () =
    <span data-count="0">C</span>oncolic_choice.return (0l, Smtml.Expr.valu<span data-count="0">e</span> (Smtml.Value.Int 1))

  let print_char ((c, _s) : Value.int32) =
    <span data-count="0">L</span>ogs.app (fun m -&gt; <span data-count="0">m</span> "%c" (char_of_in<span data-count="0">t</span> (Int32.to_in<span data-count="0">t</span> c)));
    <span data-count="0">C</span>oncolic_choice.return ()

  let cov_label_set _ _ _ =
    <span data-count="0">L</span>ogs.err (fun m -&gt; <span data-count="0">m</span> "labels are not implemented in concolic mode");
    <span data-count="0">a</span>ssert false

  let cov_label_is_covered _ =
    <span data-count="0">L</span>ogs.err (fun m -&gt; <span data-count="0">m</span> "labels are not implemented in concolic mode");
    <span data-count="0">a</span>ssert false

  let open_scope _m _strptr = <span data-count="0">a</span>ssert false

  let close_scope () = <span data-count="0">a</span>ssert false
end

type extern_func = Concolic.Extern_func.extern_func

open M
open Concolic.Extern_func
open Concolic.Extern_func.Syntax

let symbolic_extern_module =
  let functions =
    [ ("i8_symbol", Extern_func (unit ^-&gt;<span data-count="880">.</span> i32, symbol_i8))
    ; ("i16_symbol", Extern_func (unit ^-&gt;<span data-count="880">.</span> i32, symbol_i16))
    ; ("i32_symbol", Extern_func (unit ^-&gt;<span data-count="880">.</span> i32, symbol_i32))
    ; ("i64_symbol", Extern_func (unit ^-&gt;<span data-count="880">.</span> i64, symbol_i64))
    ; ("f32_symbol", Extern_func (unit ^-&gt;<span data-count="880">.</span> f32, symbol_f32))
    ; ("f64_symbol", Extern_func (unit ^-&gt;<span data-count="880">.</span> f64, symbol_f64))
    ; ("v128_symbol", Extern_func (unit ^-&gt;<span data-count="880">.</span> v128, symbol_v128))
    ; ("bool_symbol", Extern_func (unit ^-&gt;<span data-count="880">.</span> i32, symbol_bool))
    ; ("invisible_bool_symbol", Extern_func (unit ^-&gt;<span data-count="880">.</span> i32, symbol_bool))
    ; ("range_symbol", Extern_func (i32 ^-<span data-count="880">&gt;</span> i32 ^-&gt;<span data-count="880">.</span> i32, symbol_range))
    ; ("assume", Extern_func (i32 ^-&gt;<span data-count="880">.</span> unit, assume))
    ; ("assert", Extern_func (i32 ^-&gt;<span data-count="880">.</span> unit, assert'))
    ; ("in_replay_mode", Extern_func (unit ^-&gt;<span data-count="880">.</span> i32, in_replay_mode))
    ; ("print_char", Extern_func (i32 ^-&gt;<span data-count="880">.</span> unit, print_char))
    ; ("alloc", Extern_func (memory ^-<span data-count="880">&gt;</span> i32 ^-<span data-count="880">&gt;</span> i32 ^-&gt;<span data-count="880">.</span> i32, alloc))
    ; ("dealloc", Extern_func (memory ^-<span data-count="880">&gt;</span> i32 ^-&gt;<span data-count="880">.</span> i32, free))
    ; ("abort", Extern_func (unit ^-&gt;<span data-count="880">.</span> unit, abort))
    ]
  in
  { Link.functions }
</code></pre>
      </div>
    </div>
    <script src="../../coverage.js"></script>
  </body>
</html>
