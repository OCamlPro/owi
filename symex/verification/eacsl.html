<!DOCTYPE HTML>
<html lang="en" class="light sidebar-visible" dir="ltr">
    <head>
        <!-- Book generated using mdBook -->
        <meta charset="UTF-8">
        <title>E-ACSL - Owi</title>


        <!-- Custom HTML head -->

        <meta name="description" content="">
        <meta name="viewport" content="width=device-width, initial-scale=1">
        <meta name="theme-color" content="#ffffff">

        <link rel="shortcut icon" href="../../favicon.png">
        <link rel="stylesheet" href="../../css/variables.css">
        <link rel="stylesheet" href="../../css/general.css">
        <link rel="stylesheet" href="../../css/chrome.css">
        <link rel="stylesheet" href="../../css/print.css" media="print">

        <!-- Fonts -->
        <link rel="stylesheet" href="../../FontAwesome/css/font-awesome.css">
        <link rel="stylesheet" href="../../fonts/fonts.css">

        <!-- Highlight.js Stylesheets -->
        <link rel="stylesheet" id="highlight-css" href="../../highlight.css">
        <link rel="stylesheet" id="tomorrow-night-css" href="../../tomorrow-night.css">
        <link rel="stylesheet" id="ayu-highlight-css" href="../../ayu-highlight.css">

        <!-- Custom theme stylesheets -->


        <!-- Provide site root and default themes to javascript -->
        <script>
            const path_to_root = "../../";
            const default_light_theme = "light";
            const default_dark_theme = "navy";
        </script>
        <!-- Start loading toc.js asap -->
        <script src="../../toc.js"></script>
    </head>
    <body>
    <div id="mdbook-help-container">
        <div id="mdbook-help-popup">
            <h2 class="mdbook-help-title">Keyboard shortcuts</h2>
            <div>
                <p>Press <kbd>←</kbd> or <kbd>→</kbd> to navigate between chapters</p>
                <p>Press <kbd>S</kbd> or <kbd>/</kbd> to search in the book</p>
                <p>Press <kbd>?</kbd> to show this help</p>
                <p>Press <kbd>Esc</kbd> to hide this help</p>
            </div>
        </div>
    </div>
    <div id="body-container">
        <!-- Work around some values being stored in localStorage wrapped in quotes -->
        <script>
            try {
                let theme = localStorage.getItem('mdbook-theme');
                let sidebar = localStorage.getItem('mdbook-sidebar');

                if (theme.startsWith('"') && theme.endsWith('"')) {
                    localStorage.setItem('mdbook-theme', theme.slice(1, theme.length - 1));
                }

                if (sidebar.startsWith('"') && sidebar.endsWith('"')) {
                    localStorage.setItem('mdbook-sidebar', sidebar.slice(1, sidebar.length - 1));
                }
            } catch (e) { }
        </script>

        <!-- Set the theme before any content is loaded, prevents flash -->
        <script>
            const default_theme = window.matchMedia("(prefers-color-scheme: dark)").matches ? default_dark_theme : default_light_theme;
            let theme;
            try { theme = localStorage.getItem('mdbook-theme'); } catch(e) { }
            if (theme === null || theme === undefined) { theme = default_theme; }
            const html = document.documentElement;
            html.classList.remove('light')
            html.classList.add(theme);
            html.classList.add("js");
        </script>

        <input type="checkbox" id="sidebar-toggle-anchor" class="hidden">

        <!-- Hide / unhide sidebar before it is displayed -->
        <script>
            let sidebar = null;
            const sidebar_toggle = document.getElementById("sidebar-toggle-anchor");
            if (document.body.clientWidth >= 1080) {
                try { sidebar = localStorage.getItem('mdbook-sidebar'); } catch(e) { }
                sidebar = sidebar || 'visible';
            } else {
                sidebar = 'hidden';
            }
            sidebar_toggle.checked = sidebar === 'visible';
            html.classList.remove('sidebar-visible');
            html.classList.add("sidebar-" + sidebar);
        </script>

        <nav id="sidebar" class="sidebar" aria-label="Table of contents">
            <!-- populated by js -->
            <mdbook-sidebar-scrollbox class="sidebar-scrollbox"></mdbook-sidebar-scrollbox>
            <noscript>
                <iframe class="sidebar-iframe-outer" src="../../toc.html"></iframe>
            </noscript>
            <div id="sidebar-resize-handle" class="sidebar-resize-handle">
                <div class="sidebar-resize-indicator"></div>
            </div>
        </nav>

        <div id="page-wrapper" class="page-wrapper">

            <div class="page">
                <div id="menu-bar-hover-placeholder"></div>
                <div id="menu-bar" class="menu-bar sticky">
                    <div class="left-buttons">
                        <label id="sidebar-toggle" class="icon-button" for="sidebar-toggle-anchor" title="Toggle Table of Contents" aria-label="Toggle Table of Contents" aria-controls="sidebar">
                            <i class="fa fa-bars"></i>
                        </label>
                        <button id="theme-toggle" class="icon-button" type="button" title="Change theme" aria-label="Change theme" aria-haspopup="true" aria-expanded="false" aria-controls="theme-list">
                            <i class="fa fa-paint-brush"></i>
                        </button>
                        <ul id="theme-list" class="theme-popup" aria-label="Themes" role="menu">
                            <li role="none"><button role="menuitem" class="theme" id="default_theme">Auto</button></li>
                            <li role="none"><button role="menuitem" class="theme" id="light">Light</button></li>
                            <li role="none"><button role="menuitem" class="theme" id="rust">Rust</button></li>
                            <li role="none"><button role="menuitem" class="theme" id="coal">Coal</button></li>
                            <li role="none"><button role="menuitem" class="theme" id="navy">Navy</button></li>
                            <li role="none"><button role="menuitem" class="theme" id="ayu">Ayu</button></li>
                        </ul>
                        <button id="search-toggle" class="icon-button" type="button" title="Search (`/`)" aria-label="Toggle Searchbar" aria-expanded="false" aria-keyshortcuts="/ s" aria-controls="searchbar">
                            <i class="fa fa-search"></i>
                        </button>
                    </div>

                    <h1 class="menu-title">Owi</h1>

                    <div class="right-buttons">
                        <a href="../../print.html" title="Print this book" aria-label="Print this book">
                            <i id="print-button" class="fa fa-print"></i>
                        </a>

                    </div>
                </div>

                <div id="search-wrapper" class="hidden">
                    <form id="searchbar-outer" class="searchbar-outer">
                        <input type="search" id="searchbar" name="searchbar" placeholder="Search this book ..." aria-controls="searchresults-outer" aria-describedby="searchresults-header">
                    </form>
                    <div id="searchresults-outer" class="searchresults-outer hidden">
                        <div id="searchresults-header" class="searchresults-header"></div>
                        <ul id="searchresults">
                        </ul>
                    </div>
                </div>

                <!-- Apply ARIA attributes after the sidebar and the sidebar toggle button are added to the DOM -->
                <script>
                    document.getElementById('sidebar-toggle').setAttribute('aria-expanded', sidebar === 'visible');
                    document.getElementById('sidebar').setAttribute('aria-hidden', sidebar !== 'visible');
                    Array.from(document.querySelectorAll('#sidebar a')).forEach(function(link) {
                        link.setAttribute('tabIndex', sidebar === 'visible' ? 0 : -1);
                    });
                </script>

                <div id="content" class="content">
                    <main>
                        <h1 id="e-acsl"><a class="header" href="#e-acsl">E-ACSL</a></h1>
<h1 id="combining-symbolic-execution-with-runtime-assertion-checking-rac"><a class="header" href="#combining-symbolic-execution-with-runtime-assertion-checking-rac">Combining symbolic execution with runtime assertion checking (RAC)</a></h1>
<p>E-ACSL is a specification language of C codes, as well as a runtime assertion checking tool within Frama-C. It works by consuming a C program annotated with E-ACSL specifications, it generates a monitored C program which aborts its execution when the specified properties are violated at runtime.</p>
<p>Generally, such a C program runs on concrete values. Yet we can combine symbolic execution with runtime assertion checking, in order to check the properties using symbolic values. This will lead to better coverage of potential execution paths and scenarios.</p>
<h2 id="finding-primes"><a class="header" href="#finding-primes">Finding primes</a></h2>
<p>Consider the following (faulty) function <code>primes</code>, it implements the algorithm of the <strong>Sieve of Eratosthenes</strong> to find all the prime numbers smaller than <code>n</code>:</p>
<pre><code class="language-c">void primes(int *is_prime, int n) {
    for (int i = 1; i &lt; n; ++i) is_prime[i] = 1;
    for (int i = 2; i * i &lt; n; ++i) {
        if (!is_prime[i]) continue;
        for (int j = i; i * j &lt; n; ++j) {
            is_prime[i * j] = 0;
        }
    }
}
</code></pre>
<p>Initially, it marks each number as prime. It then marks as composite the multiples of each prime, iterating in an ascending order. If a number is still marked as prime at the point of iteration, then it does not admit a nontrivial factor and should be a prime.</p>
<p>In order to verify the implementation, we annotate the function <code>primes</code> using the E-ACSL specification language. The annotations should be written immediately above the function and surrounded by <code>/*@ ... */</code>.</p>
<pre><code class="language-c">#define MAX_SIZE 100

/*@ requires 2 &lt;= n &lt;= MAX_SIZE;
    requires \valid(is_prime + (0 .. (n - 1)));
    ensures  \forall integer i; 0 &lt;= i &lt; n ==&gt;
        (is_prime[i] &lt;==&gt;
            (i &gt;= 2 &amp;&amp; \forall integer j; 2 &lt;= j &lt; i ==&gt; i % j != 0));
*/
void primes(int *is_prime, int n) {
    for (int i = 0; i &lt; n; ++i) is_prime[i] = 1;
    for (int i = 2; i * i &lt; n; ++i) {
        if (!is_prime[i]) continue;
        for (int j = i; i * j &lt; n; ++j) {
            is_prime[i * j] = 0;
        }
    }
}
</code></pre>
<p>Here, <code>requires</code> and <code>ensures</code> specify the pre-condition and post-condition of the function. The annotation means:</p>
<ul>
<li>When the function is called,
<ul>
<li>the argument <code>n</code> should be between <code>2</code> and <code>MAX_SIZE</code></li>
<li>for all <code>i</code> between <code>0</code> and <code>n - 1</code>, <code>is_prime + i</code> should be memory locations safe to read and write</li>
</ul>
</li>
<li>When the function returns,
<ul>
<li>for all <code>i</code> between <code>0</code> and <code>n - 1</code>, <code>is_prime[i]</code> evaluates to <code>true</code> if and only if <code>i</code> is larger than <code>2</code> and does not have a factor between <code>2</code> and <code>i - 1</code> (which indicates the primality of <code>i</code>)</li>
</ul>
</li>
</ul>
<p>We can then call the function with symbolic values and see what happens. We should pass the option <code>--e-acsl</code> to let owi invoke the E-ACSL plugin.</p>
<!-- $MDX file=primes.c -->
<pre><code class="language-c">#define MAX_SIZE 100

#include &lt;owi.h&gt;
#include &lt;stdlib.h&gt;

/*@ requires 2 &lt;= n &lt;= MAX_SIZE;
    requires \valid(is_prime + (0 .. (n - 1)));
    ensures  \forall integer i; 0 &lt;= i &lt; n ==&gt;
        (is_prime[i] &lt;==&gt;
            (i &gt;= 2 &amp;&amp; \forall integer j; 2 &lt;= j &lt; i ==&gt; i % j != 0));
*/
void primes(int *is_prime, int n) {
    for (int i = 0; i &lt; n; ++i) is_prime[i] = 1;
    for (int i = 2; i * i &lt; n; ++i) {
        if (!is_prime[i]) continue;
        for (int j = i; i * j &lt; n; ++j) {
            is_prime[i * j] = 0;
        }
    }
}

int main(void) {
    int *is_prime;
    is_prime = malloc(MAX_SIZE * sizeof(int));

    int n = owi_i32();
    owi_assume(n &gt;= 2);
    owi_assume(n &lt;= MAX_SIZE);

    primes(is_prime, n);
    free(is_prime);
    return 0;
}
</code></pre>
<pre><code class="language-sh">$ owi c --e-acsl primes.c -w1
owi: [ERROR] Assert failure: false
model {
  symbol symbol_0 i32 2
}
owi: [ERROR] Reached problem!
[13]
</code></pre>
<p>The execution got aborted because one of the specifications has been violated with <code>n = 2</code>. (The error message is not so informative for the time being, extra information aiding the diagnostic of errors may be added in the future.)</p>
<p>The problem is that we should mark <code>0</code> and <code>1</code> as non-prime during the initialization. Let's fix it and rerun the program.</p>
<!-- $MDX file=primes2.c -->
<pre><code class="language-c">#define MAX_SIZE 100

#include &lt;owi.h&gt;
#include &lt;stdlib.h&gt;

/*@ requires 2 &lt;= n &lt;= MAX_SIZE;
    requires \valid(is_prime + (0 .. (n - 1)));
    ensures  \forall integer i; 0 &lt;= i &lt; n ==&gt;
        (is_prime[i] &lt;==&gt;
            (i &gt;= 2 &amp;&amp; \forall integer j; 2 &lt;= j &lt; i ==&gt; i % j != 0));
*/
void primes(int *is_prime, int n) {
    for (int i = 0; i &lt; n; ++i) is_prime[i] = 1;
    is_prime[0] = is_prime[1] = 0;
    for (int i = 2; i * i &lt; n; ++i) {
        if (!is_prime[i]) continue;
        for (int j = i; i * j &lt; n; ++j) {
            is_prime[i * j] = 0;
        }
    }
}

int main(void) {
    int *is_prime;
    is_prime = malloc(MAX_SIZE * sizeof(int));

    int n = owi_i32();
    owi_assume(n &gt;= 2);
    owi_assume(n &lt;= MAX_SIZE);

    primes(is_prime, n);
    free(is_prime);
    return 0;
}
</code></pre>
<pre><code class="language-sh">$ owi c --e-acsl primes2.c -w1
All OK!
</code></pre>
<p>All the specified properties have been satisfied during the execution.</p>

                    </main>

                    <nav class="nav-wrapper" aria-label="Page navigation">
                        <!-- Mobile navigation buttons -->
                            <a rel="prev" href="../../symex/verification/comparison.html" class="mobile-nav-chapters previous" title="Previous chapter" aria-label="Previous chapter" aria-keyshortcuts="Left">
                                <i class="fa fa-angle-left"></i>
                            </a>

                            <a rel="next prefetch" href="../../symex/verification/weasel.html" class="mobile-nav-chapters next" title="Next chapter" aria-label="Next chapter" aria-keyshortcuts="Right">
                                <i class="fa fa-angle-right"></i>
                            </a>

                        <div style="clear: both"></div>
                    </nav>
                </div>
            </div>

            <nav class="nav-wide-wrapper" aria-label="Page navigation">
                    <a rel="prev" href="../../symex/verification/comparison.html" class="nav-chapters previous" title="Previous chapter" aria-label="Previous chapter" aria-keyshortcuts="Left">
                        <i class="fa fa-angle-left"></i>
                    </a>

                    <a rel="next prefetch" href="../../symex/verification/weasel.html" class="nav-chapters next" title="Next chapter" aria-label="Next chapter" aria-keyshortcuts="Right">
                        <i class="fa fa-angle-right"></i>
                    </a>
            </nav>

        </div>




        <script>
            window.playground_copyable = true;
        </script>


        <script src="../../elasticlunr.min.js"></script>
        <script src="../../mark.min.js"></script>
        <script src="../../searcher.js"></script>

        <script src="../../clipboard.min.js"></script>
        <script src="../../highlight.js"></script>
        <script src="../../book.js"></script>

        <!-- Custom JS scripts -->


    </div>
    </body>
</html>
